---
globs: *.py
description: Configuration management patterns using dataclasses and centralized settings
---

# Configuration Management Patterns

Following the centralized configuration approach from [gps_preprocessor.py](mdc:gps_preprocessor.py):

## Centralized Configuration with Dataclasses
```python
from dataclasses import dataclass
from typing import Optional, Dict, Any

@dataclass
class ProcessingConfig:
    """Centralized configuration for all processing parameters"""
    
    # Input/Output
    input_file: str = "default_path.csv"
    output_dir: str = "./output"
    
    # Processing flags
    skip_validation: bool = False
    enable_filtering: bool = True
    
    # Thresholds and limits
    max_velocity_kmh: float = 150.0
    min_points_per_agent: int = 3
    
    # Complex nested configuration
    bounds: Optional[Dict[str, float]] = None
    
    def __post_init__(self):
        """Initialize computed or default values"""
        if self.bounds is None:
            self.bounds = {
                "min_lat": 39.3, "max_lat": 40.3,
                "min_lon": 116.0, "max_lon": 117.0,
            }
```

## Schema and Constants Organization
```python
class DataSchema:
    """Centralized schema definitions"""
    
    # Column definitions
    ALL_COLUMNS = ["id", "timestamp", "lat", "lon", "speed", "direction"]
    ESSENTIAL_COLUMNS = ["id", "timestamp", "lat", "lon"]
    
    # Type mappings
    COLUMN_TYPES = {
        "id": pl.Utf8,
        "timestamp": pl.Utf8,
        "lat": pl.Float64,
        "lon": pl.Float64,
    }
    
    # Validation rules
    VALID_RANGES = {
        "lat": (-90, 90),
        "lon": (-180, 180), 
        "speed": (0, 300),
    }
```

## Configuration Injection Pattern
```python
class DataProcessor:
    """Inject configuration through constructor"""
    
    def __init__(self, config: ProcessingConfig):
        self.config = config
        
        # Initialize sub-components with same config
        self.loader = DataLoader(config)
        self.cleaner = DataCleaner(config) 
        self.validator = DataValidator(config)
    
    def process(self) -> pl.DataFrame:
        """Use configuration throughout pipeline"""
        if self.config.skip_validation:
            return self.loader.load_data()
        
        df = self.loader.load_data()
        if self.config.enable_filtering:
            df = self.cleaner.clean_data(df)
        
        return df
```

## CLI Configuration Integration
```python
def main():
    """Map CLI arguments to configuration"""
    parser = argparse.ArgumentParser()
    parser.add_argument("--max_velocity", type=float, default=150)
    parser.add_argument("--skip_validation", action="store_true")
    
    args = parser.parse_args()
    
    # Create configuration from CLI args
    config = ProcessingConfig(
        max_velocity_kmh=args.max_velocity,
        skip_validation=args.skip_validation,
    )
    
    # Pass to processor
    processor = DataProcessor(config)
    results = processor.process()
```

## Configuration Validation
```python
@dataclass  
class Config:
    speed_limit: float = 150.0
    
    def __post_init__(self):
        """Validate configuration on creation"""
        if self.speed_limit <= 0:
            raise ValueError("Speed limit must be positive")
        
        if self.speed_limit > 500:
            print(f"⚠️ Warning: Very high speed limit: {self.speed_limit} km/h")
```