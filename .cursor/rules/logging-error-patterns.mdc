---
globs: *.py  
description: Logging, error handling, and user feedback patterns for data processing pipelines
---

# Logging and Error Handling Patterns

Based on user-friendly patterns from [gps_preprocessor.py](mdc:gps_preprocessor.py):

## Informative Progress Logging
```python
# âœ… Use emojis and descriptive messages for clarity
def process_data(self):
    print("ğŸ§¹ Applying data quality filters...")
    print("ğŸ“‚ Loading GPS data...")
    print("ğŸ” Filtering for specific agents...")
    print("âœ… Processing complete!")

# âœ… Show progress with numbers and percentages  
def report_results(self, original: int, final: int):
    retention = final / original * 100
    print(f"ğŸ“Š Results: {original:,} â†’ {final:,} records ({retention:.1f}% retained)")

# âœ… Display detailed statistics
def show_filtering_results(self, stats: Dict[str, int]):
    print("ğŸ“Š Data Quality Filtering Results:")
    print(f"  Original records: {stats['original']:,}")
    print(f"  After deduplication: {stats['after_dedup']:,} (-{stats['removed_dupes']})")
    print(f"  After validation: {stats['after_valid']:,} (-{stats['removed_invalid']})")
    print(f"  Overall retention: {stats['retention']:.1f}%")
```

## Warning and Error Messages
```python
# âœ… Clear warnings with context
def check_data_quality(self, df: pl.DataFrame):
    retention_rate = len(df) / self.original_count * 100
    
    if retention_rate < 50:
        print(f"âš ï¸  WARNING: {100 - retention_rate:.1f}% data loss during processing")
        print("ğŸ’¡ Consider adjusting filter parameters")
    
    if retention_rate < 10:
        print("ğŸš¨ CRITICAL: Very high data loss - check input data quality")

# âœ… Helpful error messages with suggestions  
def validate_agents(self, agent_filter: str):
    try:
        int(agent_filter)
        print("âŒ Random agent selection removed for efficiency.")
        print("ğŸ’¡ Use specific license plates: --filter_agents 'plate1,plate2'")
        print("ğŸ’¡ Or use --nrows for development/testing")
        return None
    except ValueError:
        # Valid string input
        pass
```

## Structured Error Handling
```python
def load_data(self) -> Dict[str, Any]:
    """Return structured results instead of raising exceptions"""
    try:
        df = self._load_csv_file()
        return {"status": "success", "data": df, "records": len(df)}
        
    except FileNotFoundError:
        return {"status": "failed", "reason": "file_not_found", "data": None}
        
    except Exception as e:
        return {"status": "failed", "reason": str(e), "data": None}

def process_pipeline(self) -> Dict[str, Any]:
    """Handle pipeline failures gracefully"""
    try:
        result = self._run_processing()
        return self._create_success_result(result)
        
    except Exception as e:
        print(f"âŒ Pipeline failed: {e}")
        return {"status": "failed", "reason": str(e)}
```

## Progress Reporting Patterns
```python
# âœ… Report problems found during processing
def detect_problematic_data(self, problematic_items: List[str]):
    if not problematic_items:
        print("âœ… No problematic data detected")
        return
    
    print(f"\nâš ï¸  DETECTED {len(problematic_items)} PROBLEMATIC ITEMS:")
    print("-" * 60)
    
    # Show first few items, summarize rest
    for i, item in enumerate(sorted(problematic_items)):
        if i < 5:  # Limit display for readability
            print(f"ğŸš¨ {item}: Issue description")
    
    if len(problematic_items) > 5:
        print(f"   ... and {len(problematic_items) - 5} more items")

# âœ… Summary reporting
def print_pipeline_summary(self, results: Dict[str, Any]):
    print("\n" + "=" * 60)
    print("ğŸ“‹ PIPELINE EXECUTION SUMMARY")
    print("=" * 60)
    
    status_emoji = "âœ… SUCCESS" if results["status"] == "success" else "âŒ FAILED"
    print(f"Status: {status_emoji}")
    
    if "final_records" in results:
        print(f"Records processed: {results['final_records']:,}")
        print(f"Processing time: {results.get('duration', 'N/A')}")
    
    print("=" * 60)
```

## Debugging and Development Support
```python
# âœ… Conditional debug output
def _debug_log(self, message: str, debug: bool = False):
    if debug or os.getenv("DEBUG"):
        print(f"ğŸ› DEBUG: {message}")

# âœ… Helpful development guidance
def handle_no_data_found(self):
    print("ğŸ“Š Loaded 0 GPS records")
    print("ğŸ’¡ Troubleshooting:")
    print("   - Check if license plates exist in dataset")
    print("   - Try removing --nrows limit")
    print("   - Verify file path and format")
    print("   - Use --filter_agents without --nrows for testing")
```