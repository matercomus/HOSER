2025-11-04 17:44:06,687 - INFO - Running only phases: {'abnormal'}
2025-11-04 17:44:06,687 - INFO - Working directory: /home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732
2025-11-04 17:44:06,687 - INFO - Validating pipeline configuration...
2025-11-04 17:44:06,743 - INFO - Configuration validation passed
2025-11-04 17:44:06,747 - INFO - Starting HOSER Distillation Evaluation Pipeline
2025-11-04 17:44:06,747 - INFO - Configuration: {'eval_dir': PosixPath('/home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732'), 'wandb_project': 'hoser-porto-eval', 'dataset': 'porto_hoser', 'cuda_device': 0, 'num_gene': 5000, 'seed': 42, 'models': [], 'od_sources': ['train', 'test'], 'phases': {'abnormal'}, 'force': False, 'enable_wandb': True, 'verbose': False, 'beam_width': 4, 'grid_size': 0.001, 'edr_eps': 100.0, 'background_sync': True, 'run_scenarios': True, 'scenarios_config': 'config/scenarios_porto.yaml', 'cross_dataset_eval': None, 'cross_dataset_name': 'BJUT_Beijing', 'run_abnormal_detection': True, 'abnormal_config': 'config/abnormal_detection_statistical.yaml'}
2025-11-04 17:44:06,748 - INFO - Enabled phases: ['abnormal']
2025-11-04 17:44:06,748 - INFO - Detected models: ['distill_phase1', 'distill_phase1_seed43', 'distill_phase1_seed44', 'distill_phase2', 'distill_phase2_seed43', 'distill_phase2_seed44', 'vanilla', 'vanilla_seed43', 'vanilla_seed44']
2025-11-04 17:44:06,748 - INFO - Models to process: ['distill_phase1', 'distill_phase1_seed43', 'distill_phase1_seed44', 'distill_phase2', 'distill_phase2_seed43', 'distill_phase2_seed44', 'vanilla', 'vanilla_seed43', 'vanilla_seed44']
2025-11-04 17:44:06,748 - INFO - OD sources: ['train', 'test']
2025-11-04 17:44:06,748 - INFO - ‚è≠Ô∏è  Skipping phase: generation
2025-11-04 17:44:06,748 - INFO - ‚è≠Ô∏è  Skipping phase: base_eval
2025-11-04 17:44:06,748 - INFO - ‚è≠Ô∏è  Skipping phase: cross_dataset
2025-11-04 17:44:06,749 - INFO - ‚è≠Ô∏è  Skipping phase: road_network_translate
2025-11-04 17:44:06,749 - INFO - 
======================================================================
2025-11-04 17:44:06,749 - INFO - üöÄ Running phase: abnormal
2025-11-04 17:44:06,749 - INFO - ======================================================================
2025-11-04 17:44:06,749 - INFO - üîç Running abnormal detection...
2025-11-04 17:44:06,749 - INFO - 
üîç Starting abnormal trajectory detection analysis...
2025-11-04 17:44:06,749 - INFO - Will analyze 1 dataset(s): ['porto_hoser']
2025-11-04 17:44:06,749 - INFO - 
======================================================================
2025-11-04 17:44:06,749 - INFO - üìä Analyzing dataset: porto_hoser (main)
2025-11-04 17:44:06,749 - INFO - ======================================================================
2025-11-04 17:44:06,749 - INFO - 
üîç Step 1: Detecting abnormal trajectories in real data...
2025-11-04 17:44:06,755 - INFO - 
  üìÇ Processing train data...
2025-11-04 17:44:06,756 - INFO -     üîç Detecting abnormal trajectories in REAL data...
2025-11-04 17:44:06,756 - INFO - üîç Starting abnormal trajectory analysis...
2025-11-04 17:44:06,756 - INFO - üìÇ Dataset: porto_hoser
2025-11-04 17:44:06,756 - INFO - üìÇ Input file: /home/matt/Dev/HOSER/data/porto_hoser/train.csv
2025-11-04 17:44:06,756 - INFO - ‚öôÔ∏è  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:44:06,762 - INFO - üíæ Output directory: abnormal/porto_hoser/train/real_data
2025-11-04 17:44:06,769 - INFO - üîç Detection method: wang_statistical
2025-11-04 17:44:06,770 - INFO - ‚öôÔ∏è  Loading configuration...
2025-11-04 17:44:06,770 - INFO - üìÇ Loading road network...
2025-11-04 17:44:07,515 - INFO - üìÇ Loading real trajectories...
2025-11-04 17:46:51,267 - INFO - ‚úÖ Loaded 481359 trajectories
2025-11-04 17:46:51,268 - INFO - üìä Using Wang et al. 2018 statistical detection
2025-11-04 17:46:51,274 - INFO - ‚úÖ Found baselines: baselines_porto_hoser.json
2025-11-04 17:46:51,274 - INFO - üìä Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732/../baselines/baselines_porto_hoser.json
2025-11-04 17:46:53,971 - INFO - ‚úÖ Loaded baselines for 346,455 OD pairs
2025-11-04 17:46:53,971 - INFO -    OD pairs with ‚â•5 samples: 17,735 (5.1%)
2025-11-04 17:47:37,741 - INFO - üìä Prepared 481359 trajectories for analysis
2025-11-04 17:47:38,314 - INFO - ‚úÖ Wang Statistical Detector initialized
2025-11-04 17:47:38,314 - INFO -    Threshold strategy: hybrid
2025-11-04 17:47:38,314 - INFO -    Fixed thresholds: L_œÅ=5000m, T_œÅ=300s
2025-11-04 17:47:38,314 - INFO -    Statistical multipliers: œÉ_length=2.5, œÉ_time=2.5
2025-11-04 17:47:38,314 - INFO - üîç Analyzing 481,359 trajectories...
2025-11-04 17:47:45,904 - INFO -    Processed 10,000 / 481,359 trajectories...
2025-11-04 17:47:47,510 - INFO -    Processed 20,000 / 481,359 trajectories...
2025-11-04 17:47:49,129 - INFO -    Processed 30,000 / 481,359 trajectories...
2025-11-04 17:47:50,728 - INFO -    Processed 40,000 / 481,359 trajectories...
2025-11-04 17:47:52,331 - INFO -    Processed 50,000 / 481,359 trajectories...
2025-11-04 17:47:53,960 - INFO -    Processed 60,000 / 481,359 trajectories...
2025-11-04 17:47:55,588 - INFO -    Processed 70,000 / 481,359 trajectories...
2025-11-04 17:47:57,225 - INFO -    Processed 80,000 / 481,359 trajectories...
2025-11-04 17:47:58,865 - INFO -    Processed 90,000 / 481,359 trajectories...
2025-11-04 17:48:00,519 - INFO -    Processed 100,000 / 481,359 trajectories...
2025-11-04 17:48:02,148 - INFO -    Processed 110,000 / 481,359 trajectories...
2025-11-04 17:48:03,746 - INFO -    Processed 120,000 / 481,359 trajectories...
2025-11-04 17:48:05,380 - INFO -    Processed 130,000 / 481,359 trajectories...
2025-11-04 17:48:06,980 - INFO -    Processed 140,000 / 481,359 trajectories...
2025-11-04 17:48:08,610 - INFO -    Processed 150,000 / 481,359 trajectories...
2025-11-04 17:48:10,230 - INFO -    Processed 160,000 / 481,359 trajectories...
2025-11-04 17:48:11,845 - INFO -    Processed 170,000 / 481,359 trajectories...
2025-11-04 17:48:13,507 - INFO -    Processed 180,000 / 481,359 trajectories...
2025-11-04 17:48:15,120 - INFO -    Processed 190,000 / 481,359 trajectories...
2025-11-04 17:48:16,739 - INFO -    Processed 200,000 / 481,359 trajectories...
2025-11-04 17:48:18,371 - INFO -    Processed 210,000 / 481,359 trajectories...
2025-11-04 17:48:19,974 - INFO -    Processed 220,000 / 481,359 trajectories...
2025-11-04 17:48:21,571 - INFO -    Processed 230,000 / 481,359 trajectories...
2025-11-04 17:48:23,187 - INFO -    Processed 240,000 / 481,359 trajectories...
2025-11-04 17:48:24,835 - INFO -    Processed 250,000 / 481,359 trajectories...
2025-11-04 17:48:26,473 - INFO -    Processed 260,000 / 481,359 trajectories...
2025-11-04 17:48:28,098 - INFO -    Processed 270,000 / 481,359 trajectories...
2025-11-04 17:48:29,718 - INFO -    Processed 280,000 / 481,359 trajectories...
2025-11-04 17:48:31,323 - INFO -    Processed 290,000 / 481,359 trajectories...
2025-11-04 17:48:32,934 - INFO -    Processed 300,000 / 481,359 trajectories...
2025-11-04 17:48:34,539 - INFO -    Processed 310,000 / 481,359 trajectories...
2025-11-04 17:48:36,147 - INFO -    Processed 320,000 / 481,359 trajectories...
2025-11-04 17:48:37,773 - INFO -    Processed 330,000 / 481,359 trajectories...
2025-11-04 17:48:39,383 - INFO -    Processed 340,000 / 481,359 trajectories...
2025-11-04 17:48:41,000 - INFO -    Processed 350,000 / 481,359 trajectories...
2025-11-04 17:48:42,692 - INFO -    Processed 360,000 / 481,359 trajectories...
2025-11-04 17:48:44,289 - INFO -    Processed 370,000 / 481,359 trajectories...
2025-11-04 17:48:45,932 - INFO -    Processed 380,000 / 481,359 trajectories...
2025-11-04 17:48:47,533 - INFO -    Processed 390,000 / 481,359 trajectories...
2025-11-04 17:48:49,195 - INFO -    Processed 400,000 / 481,359 trajectories...
2025-11-04 17:48:50,839 - INFO -    Processed 410,000 / 481,359 trajectories...
2025-11-04 17:48:52,474 - INFO -    Processed 420,000 / 481,359 trajectories...
2025-11-04 17:48:54,114 - INFO -    Processed 430,000 / 481,359 trajectories...
2025-11-04 17:48:55,710 - INFO -    Processed 440,000 / 481,359 trajectories...
2025-11-04 17:48:57,351 - INFO -    Processed 450,000 / 481,359 trajectories...
2025-11-04 17:48:59,018 - INFO -    Processed 460,000 / 481,359 trajectories...
2025-11-04 17:49:00,662 - INFO -    Processed 470,000 / 481,359 trajectories...
2025-11-04 17:49:02,579 - INFO -    Processed 480,000 / 481,359 trajectories...
2025-11-04 17:49:02,812 - INFO - üìä Detection Results:
2025-11-04 17:49:02,812 - INFO -    Total trajectories: 481,359
2025-11-04 17:49:02,812 - INFO -    Abp1 (Normal): 435,673
2025-11-04 17:49:02,813 - INFO -    Abp2 (Temporal delay): 45,686
2025-11-04 17:49:02,813 - INFO -    Abp3 (Route deviation): 0
2025-11-04 17:49:02,813 - INFO -    Abp4 (Both deviations): 0
2025-11-04 17:49:02,813 - INFO -    Abnormal rate: 9.49%
2025-11-04 17:49:02,813 - INFO - üìä Baseline usage:
2025-11-04 17:49:02,813 - INFO -    OD-specific: 150,443
2025-11-04 17:49:02,813 - INFO -    Global fallback: 330,916
2025-11-04 17:49:03,613 - INFO - üíæ Saving detection results...
2025-11-04 17:49:03,685 - INFO - ‚úÖ Saved detection results to abnormal/porto_hoser/train/real_data/detection_results.json
2025-11-04 17:49:03,686 - INFO - ‚úÖ Saved statistics to abnormal/porto_hoser/train/real_data/statistics_by_category.json
2025-11-04 17:49:03,691 - INFO - üíæ Saving trajectory samples...
2025-11-04 17:49:03,691 - ERROR -   ‚ùå Abnormal analysis failed for train: 'all_results'
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732/../tools/analyze_abnormal.py", line 656, in run_abnormal_analysis
    (r for r in results["all_results"] if r["traj_idx"] == idx), None
                ~~~~~~~^^^^^^^^^^^^^^^
KeyError: 'all_results'
2025-11-04 17:49:03,986 - INFO - 
  üìÇ Processing test data...
2025-11-04 17:49:03,986 - INFO -     üîç Detecting abnormal trajectories in REAL data...
2025-11-04 17:49:03,986 - INFO - üîç Starting abnormal trajectory analysis...
2025-11-04 17:49:03,986 - INFO - üìÇ Dataset: porto_hoser
2025-11-04 17:49:03,986 - INFO - üìÇ Input file: /home/matt/Dev/HOSER/data/porto_hoser/test.csv
2025-11-04 17:49:03,987 - INFO - ‚öôÔ∏è  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:49:03,992 - INFO - üíæ Output directory: abnormal/porto_hoser/test/real_data
2025-11-04 17:49:04,001 - INFO - üîç Detection method: wang_statistical
2025-11-04 17:49:04,002 - INFO - ‚öôÔ∏è  Loading configuration...
2025-11-04 17:49:04,002 - INFO - üìÇ Loading road network...
2025-11-04 17:49:04,014 - INFO - üìÇ Loading real trajectories...
