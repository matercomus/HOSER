2025-11-04 17:34:18,628 - INFO - Running only phases: {'abnormal'}
2025-11-04 17:34:18,628 - INFO - Working directory: /home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732
2025-11-04 17:34:18,628 - INFO - Validating pipeline configuration...
2025-11-04 17:34:18,681 - INFO - Configuration validation passed
2025-11-04 17:34:18,685 - INFO - Starting HOSER Distillation Evaluation Pipeline
2025-11-04 17:34:18,685 - INFO - Configuration: {'eval_dir': PosixPath('/home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732'), 'wandb_project': 'hoser-porto-eval', 'dataset': 'porto_hoser', 'cuda_device': 0, 'num_gene': 5000, 'seed': 42, 'models': [], 'od_sources': ['train', 'test'], 'phases': {'abnormal'}, 'force': False, 'enable_wandb': True, 'verbose': False, 'beam_width': 4, 'grid_size': 0.001, 'edr_eps': 100.0, 'background_sync': True, 'run_scenarios': True, 'scenarios_config': 'config/scenarios_porto.yaml', 'cross_dataset_eval': None, 'cross_dataset_name': 'BJUT_Beijing', 'run_abnormal_detection': True, 'abnormal_config': 'config/abnormal_detection_statistical.yaml'}
2025-11-04 17:34:18,685 - INFO - Enabled phases: ['abnormal']
2025-11-04 17:34:18,685 - INFO - Detected models: ['distill_phase1', 'distill_phase1_seed43', 'distill_phase1_seed44', 'distill_phase2', 'distill_phase2_seed43', 'distill_phase2_seed44', 'vanilla', 'vanilla_seed43', 'vanilla_seed44']
2025-11-04 17:34:18,686 - INFO - Models to process: ['distill_phase1', 'distill_phase1_seed43', 'distill_phase1_seed44', 'distill_phase2', 'distill_phase2_seed43', 'distill_phase2_seed44', 'vanilla', 'vanilla_seed43', 'vanilla_seed44']
2025-11-04 17:34:18,686 - INFO - OD sources: ['train', 'test']
2025-11-04 17:34:18,686 - INFO - ‚è≠Ô∏è  Skipping phase: generation
2025-11-04 17:34:18,686 - INFO - ‚è≠Ô∏è  Skipping phase: base_eval
2025-11-04 17:34:18,686 - INFO - ‚è≠Ô∏è  Skipping phase: cross_dataset
2025-11-04 17:34:18,686 - INFO - ‚è≠Ô∏è  Skipping phase: road_network_translate
2025-11-04 17:34:18,686 - INFO - 
======================================================================
2025-11-04 17:34:18,686 - INFO - üöÄ Running phase: abnormal
2025-11-04 17:34:18,686 - INFO - ======================================================================
2025-11-04 17:34:18,686 - INFO - üîç Running abnormal detection...
2025-11-04 17:34:18,686 - INFO - 
üîç Starting abnormal trajectory detection analysis...
2025-11-04 17:34:18,687 - INFO - Will analyze 1 dataset(s): ['porto_hoser']
2025-11-04 17:34:18,687 - INFO - 
======================================================================
2025-11-04 17:34:18,687 - INFO - üìä Analyzing dataset: porto_hoser (main)
2025-11-04 17:34:18,687 - INFO - ======================================================================
2025-11-04 17:34:18,687 - INFO - 
üîç Step 1: Detecting abnormal trajectories in real data...
2025-11-04 17:34:18,693 - INFO - 
  üìÇ Processing train data...
2025-11-04 17:34:18,693 - INFO -     üîç Detecting abnormal trajectories in REAL data...
2025-11-04 17:34:18,693 - INFO - üîç Starting abnormal trajectory analysis...
2025-11-04 17:34:18,693 - INFO - üìÇ Dataset: porto_hoser
2025-11-04 17:34:18,693 - INFO - üìÇ Input file: /home/matt/Dev/HOSER/data/porto_hoser/train.csv
2025-11-04 17:34:18,693 - INFO - ‚öôÔ∏è  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:34:18,701 - INFO - üíæ Output directory: abnormal/porto_hoser/train/real_data
2025-11-04 17:34:18,707 - INFO - üîç Detection method: wang_statistical
2025-11-04 17:34:18,707 - INFO - ‚öôÔ∏è  Loading configuration...
2025-11-04 17:34:18,708 - INFO - üìÇ Loading road network...
2025-11-04 17:34:19,333 - INFO - üìÇ Loading real trajectories...
2025-11-04 17:36:59,923 - INFO - ‚úÖ Loaded 481359 trajectories
2025-11-04 17:36:59,924 - INFO - üìä Using Wang et al. 2018 statistical detection
2025-11-04 17:36:59,932 - INFO - ‚úÖ Found baselines: baselines_porto_hoser.json
2025-11-04 17:36:59,933 - INFO - üìä Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732/../baselines/baselines_porto_hoser.json
2025-11-04 17:37:02,560 - INFO - ‚úÖ Loaded baselines for 346,455 OD pairs
2025-11-04 17:37:02,560 - INFO -    OD pairs with ‚â•5 samples: 17,735 (5.1%)
2025-11-04 17:37:45,866 - INFO - üìä Prepared 481359 trajectories for analysis
2025-11-04 17:37:46,481 - INFO - ‚úÖ Wang Statistical Detector initialized
2025-11-04 17:37:46,481 - INFO -    Threshold strategy: hybrid
2025-11-04 17:37:46,481 - INFO -    Fixed thresholds: L_œÅ=5000m, T_œÅ=300s
2025-11-04 17:37:46,481 - INFO -    Statistical multipliers: œÉ_length=2.5, œÉ_time=2.5
2025-11-04 17:37:46,481 - INFO - üîç Analyzing 481,359 trajectories...
2025-11-04 17:37:53,921 - INFO -    Processed 10,000 / 481,359 trajectories...
2025-11-04 17:37:55,532 - INFO -    Processed 20,000 / 481,359 trajectories...
2025-11-04 17:37:57,099 - INFO -    Processed 30,000 / 481,359 trajectories...
2025-11-04 17:37:58,667 - INFO -    Processed 40,000 / 481,359 trajectories...
2025-11-04 17:38:00,322 - INFO -    Processed 50,000 / 481,359 trajectories...
2025-11-04 17:38:01,933 - INFO -    Processed 60,000 / 481,359 trajectories...
2025-11-04 17:38:03,557 - INFO -    Processed 70,000 / 481,359 trajectories...
2025-11-04 17:38:05,127 - INFO -    Processed 80,000 / 481,359 trajectories...
2025-11-04 17:38:06,708 - INFO -    Processed 90,000 / 481,359 trajectories...
2025-11-04 17:38:08,274 - INFO -    Processed 100,000 / 481,359 trajectories...
2025-11-04 17:38:09,793 - INFO -    Processed 110,000 / 481,359 trajectories...
2025-11-04 17:38:11,406 - INFO -    Processed 120,000 / 481,359 trajectories...
2025-11-04 17:38:12,979 - INFO -    Processed 130,000 / 481,359 trajectories...
2025-11-04 17:38:14,601 - INFO -    Processed 140,000 / 481,359 trajectories...
2025-11-04 17:38:16,169 - INFO -    Processed 150,000 / 481,359 trajectories...
2025-11-04 17:38:17,794 - INFO -    Processed 160,000 / 481,359 trajectories...
2025-11-04 17:38:19,406 - INFO -    Processed 170,000 / 481,359 trajectories...
2025-11-04 17:38:20,959 - INFO -    Processed 180,000 / 481,359 trajectories...
2025-11-04 17:38:22,557 - INFO -    Processed 190,000 / 481,359 trajectories...
2025-11-04 17:38:24,114 - INFO -    Processed 200,000 / 481,359 trajectories...
2025-11-04 17:38:25,685 - INFO -    Processed 210,000 / 481,359 trajectories...
2025-11-04 17:38:27,248 - INFO -    Processed 220,000 / 481,359 trajectories...
2025-11-04 17:38:28,808 - INFO -    Processed 230,000 / 481,359 trajectories...
2025-11-04 17:38:30,398 - INFO -    Processed 240,000 / 481,359 trajectories...
2025-11-04 17:38:31,948 - INFO -    Processed 250,000 / 481,359 trajectories...
2025-11-04 17:38:33,513 - INFO -    Processed 260,000 / 481,359 trajectories...
2025-11-04 17:38:35,089 - INFO -    Processed 270,000 / 481,359 trajectories...
2025-11-04 17:38:36,671 - INFO -    Processed 280,000 / 481,359 trajectories...
2025-11-04 17:38:38,267 - INFO -    Processed 290,000 / 481,359 trajectories...
2025-11-04 17:38:39,852 - INFO -    Processed 300,000 / 481,359 trajectories...
2025-11-04 17:38:41,417 - INFO -    Processed 310,000 / 481,359 trajectories...
2025-11-04 17:38:43,008 - INFO -    Processed 320,000 / 481,359 trajectories...
2025-11-04 17:38:44,544 - INFO -    Processed 330,000 / 481,359 trajectories...
2025-11-04 17:38:46,113 - INFO -    Processed 340,000 / 481,359 trajectories...
2025-11-04 17:38:47,676 - INFO -    Processed 350,000 / 481,359 trajectories...
2025-11-04 17:38:49,279 - INFO -    Processed 360,000 / 481,359 trajectories...
2025-11-04 17:38:50,883 - INFO -    Processed 370,000 / 481,359 trajectories...
2025-11-04 17:38:52,454 - INFO -    Processed 380,000 / 481,359 trajectories...
2025-11-04 17:38:54,026 - INFO -    Processed 390,000 / 481,359 trajectories...
2025-11-04 17:38:55,595 - INFO -    Processed 400,000 / 481,359 trajectories...
2025-11-04 17:38:57,183 - INFO -    Processed 410,000 / 481,359 trajectories...
2025-11-04 17:38:58,745 - INFO -    Processed 420,000 / 481,359 trajectories...
2025-11-04 17:39:00,305 - INFO -    Processed 430,000 / 481,359 trajectories...
2025-11-04 17:39:01,858 - INFO -    Processed 440,000 / 481,359 trajectories...
2025-11-04 17:39:03,450 - INFO -    Processed 450,000 / 481,359 trajectories...
2025-11-04 17:39:05,029 - INFO -    Processed 460,000 / 481,359 trajectories...
2025-11-04 17:39:06,579 - INFO -    Processed 470,000 / 481,359 trajectories...
2025-11-04 17:39:08,128 - INFO -    Processed 480,000 / 481,359 trajectories...
2025-11-04 17:39:08,334 - INFO - üìä Detection Results:
2025-11-04 17:39:08,334 - INFO -    Total trajectories: 481,359
2025-11-04 17:39:08,334 - INFO -    Abp1 (Normal): 435,673
2025-11-04 17:39:08,335 - INFO -    Abp2 (Temporal delay): 45,686
2025-11-04 17:39:08,335 - INFO -    Abp3 (Route deviation): 0
2025-11-04 17:39:08,335 - INFO -    Abp4 (Both deviations): 0
2025-11-04 17:39:08,335 - INFO -    Abnormal rate: 9.49%
2025-11-04 17:39:08,335 - INFO - üìä Baseline usage:
2025-11-04 17:39:08,335 - INFO -    OD-specific: 150,443
2025-11-04 17:39:08,335 - INFO -    Global fallback: 330,916
2025-11-04 17:39:09,132 - INFO - üíæ Saving detection results...
2025-11-04 17:39:09,207 - INFO - ‚úÖ Saved detection results to abnormal/porto_hoser/train/real_data/detection_results.json
2025-11-04 17:39:09,207 - INFO - ‚úÖ Saved statistics to abnormal/porto_hoser/train/real_data/statistics_by_category.json
2025-11-04 17:39:09,208 - ERROR -   ‚ùå Abnormal analysis failed for train: cannot access local variable 'config' where it is not associated with a value
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732/../tools/analyze_abnormal.py", line 631, in run_abnormal_analysis
    if config.analysis_config.get("save_trajectory_samples", False):
       ^^^^^^
UnboundLocalError: cannot access local variable 'config' where it is not associated with a value
2025-11-04 17:39:09,539 - INFO - 
  üìÇ Processing test data...
2025-11-04 17:39:09,539 - INFO -     üîç Detecting abnormal trajectories in REAL data...
2025-11-04 17:39:09,539 - INFO - üîç Starting abnormal trajectory analysis...
2025-11-04 17:39:09,539 - INFO - üìÇ Dataset: porto_hoser
2025-11-04 17:39:09,539 - INFO - üìÇ Input file: /home/matt/Dev/HOSER/data/porto_hoser/test.csv
2025-11-04 17:39:09,539 - INFO - ‚öôÔ∏è  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:39:09,546 - INFO - üíæ Output directory: abnormal/porto_hoser/test/real_data
2025-11-04 17:39:09,551 - INFO - üîç Detection method: wang_statistical
2025-11-04 17:39:09,551 - INFO - ‚öôÔ∏è  Loading configuration...
2025-11-04 17:39:09,551 - INFO - üìÇ Loading road network...
2025-11-04 17:39:09,577 - INFO - üìÇ Loading real trajectories...
2025-11-04 17:39:55,712 - INFO - ‚úÖ Loaded 137532 trajectories
2025-11-04 17:39:55,713 - INFO - üìä Using Wang et al. 2018 statistical detection
2025-11-04 17:39:55,718 - INFO - ‚úÖ Found baselines: baselines_porto_hoser.json
2025-11-04 17:39:55,718 - INFO - üìä Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732/../baselines/baselines_porto_hoser.json
2025-11-04 17:39:58,048 - INFO - ‚úÖ Loaded baselines for 346,455 OD pairs
2025-11-04 17:39:58,048 - INFO -    OD pairs with ‚â•5 samples: 17,735 (5.1%)
2025-11-04 17:40:09,302 - INFO - üìä Prepared 137532 trajectories for analysis
2025-11-04 17:40:09,858 - INFO - ‚úÖ Wang Statistical Detector initialized
2025-11-04 17:40:09,858 - INFO -    Threshold strategy: hybrid
2025-11-04 17:40:09,858 - INFO -    Fixed thresholds: L_œÅ=5000m, T_œÅ=300s
2025-11-04 17:40:09,858 - INFO -    Statistical multipliers: œÉ_length=2.5, œÉ_time=2.5
2025-11-04 17:40:09,858 - INFO - üîç Analyzing 137,532 trajectories...
2025-11-04 17:40:14,006 - INFO -    Processed 10,000 / 137,532 trajectories...
2025-11-04 17:40:15,618 - INFO -    Processed 20,000 / 137,532 trajectories...
2025-11-04 17:40:17,209 - INFO -    Processed 30,000 / 137,532 trajectories...
2025-11-04 17:40:18,781 - INFO -    Processed 40,000 / 137,532 trajectories...
2025-11-04 17:40:20,384 - INFO -    Processed 50,000 / 137,532 trajectories...
2025-11-04 17:40:22,095 - INFO -    Processed 60,000 / 137,532 trajectories...
2025-11-04 17:40:23,669 - INFO -    Processed 70,000 / 137,532 trajectories...
2025-11-04 17:40:25,305 - INFO -    Processed 80,000 / 137,532 trajectories...
2025-11-04 17:40:26,967 - INFO -    Processed 90,000 / 137,532 trajectories...
2025-11-04 17:40:28,580 - INFO -    Processed 100,000 / 137,532 trajectories...
2025-11-04 17:40:30,180 - INFO -    Processed 110,000 / 137,532 trajectories...
2025-11-04 17:40:31,778 - INFO -    Processed 120,000 / 137,532 trajectories...
2025-11-04 17:40:33,367 - INFO -    Processed 130,000 / 137,532 trajectories...
2025-11-04 17:40:34,538 - INFO - üìä Detection Results:
2025-11-04 17:40:34,538 - INFO -    Total trajectories: 137,532
2025-11-04 17:40:34,538 - INFO -    Abp1 (Normal): 124,551
2025-11-04 17:40:34,538 - INFO -    Abp2 (Temporal delay): 12,981
2025-11-04 17:40:34,538 - INFO -    Abp3 (Route deviation): 0
2025-11-04 17:40:34,538 - INFO -    Abp4 (Both deviations): 0
2025-11-04 17:40:34,538 - INFO -    Abnormal rate: 9.44%
2025-11-04 17:40:34,538 - INFO - üìä Baseline usage:
2025-11-04 17:40:34,538 - INFO -    OD-specific: 42,934
2025-11-04 17:40:34,538 - INFO -    Global fallback: 94,598
2025-11-04 17:40:34,768 - INFO - üíæ Saving detection results...
2025-11-04 17:40:34,807 - INFO - ‚úÖ Saved detection results to abnormal/porto_hoser/test/real_data/detection_results.json
2025-11-04 17:40:34,807 - INFO - ‚úÖ Saved statistics to abnormal/porto_hoser/test/real_data/statistics_by_category.json
2025-11-04 17:40:34,807 - ERROR -   ‚ùå Abnormal analysis failed for test: cannot access local variable 'config' where it is not associated with a value
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-porto-eval-eb0e88ab-20251026_152732/../tools/analyze_abnormal.py", line 631, in run_abnormal_analysis
    if config.analysis_config.get("save_trajectory_samples", False):
       ^^^^^^
UnboundLocalError: cannot access local variable 'config' where it is not associated with a value
2025-11-04 17:40:34,944 - INFO - 
‚úÖ Abnormal analysis complete for porto_hoser! Results in abnormal/porto_hoser/
2025-11-04 17:40:34,944 - INFO - ‚úÖ Phase abnormal completed
2025-11-04 17:40:34,944 - INFO - ‚è≠Ô∏è  Skipping phase: abnormal_od_extract
2025-11-04 17:40:34,944 - INFO - ‚è≠Ô∏è  Skipping phase: abnormal_od_generate
2025-11-04 17:40:34,944 - INFO - ‚è≠Ô∏è  Skipping phase: abnormal_od_evaluate
2025-11-04 17:40:34,945 - INFO - ‚è≠Ô∏è  Skipping phase: scenarios
2025-11-04 17:40:34,945 - INFO - 
‚úÖ Pipeline completed successfully!
2025-11-04 17:40:34,945 - INFO - ‚úÖ Pipeline completed successfully!
üìÇ Loading road network...
üìê Calculating road centroids for 11,024 roads...
‚úÖ Road network loaded: 11,024 valid roads
üìÇ Loading trajectories from /home/matt/Dev/HOSER/data/porto_hoser/train.csv...
üîÑ Parsing 481,359 trajectories...
‚úÖ Loaded 481,359 valid trajectories (dropped 0)
üìÇ Using cached road network...
üìÇ Loading trajectories from /home/matt/Dev/HOSER/data/porto_hoser/test.csv...
üîÑ Parsing 137,532 trajectories...
‚úÖ Loaded 137,532 valid trajectories (dropped 0)
