2025-11-04 17:21:42,601 - INFO - Running only phases: {'abnormal'}
2025-11-04 17:21:42,602 - INFO - Working directory: /home/matt/Dev/HOSER/hoser-distill-optuna-6
2025-11-04 17:21:42,602 - INFO - Validating pipeline configuration...
2025-11-04 17:21:42,607 - INFO - âœ“ Cross-dataset evaluation enabled: BJUT_Beijing
2025-11-04 17:21:42,655 - INFO - Configuration validation passed
2025-11-04 17:21:42,659 - INFO - Starting HOSER Distillation Evaluation Pipeline
2025-11-04 17:21:42,659 - INFO - Configuration: {'eval_dir': PosixPath('/home/matt/Dev/HOSER/hoser-distill-optuna-6'), 'wandb_project': 'hoser-distill-optuna-6', 'dataset': 'Beijing', 'cuda_device': 0, 'num_gene': 5000, 'seed': 42, 'models': [], 'od_sources': ['train', 'test'], 'phases': {'abnormal'}, 'force': False, 'enable_wandb': True, 'verbose': False, 'beam_width': 4, 'grid_size': 0.001, 'edr_eps': 100.0, 'background_sync': True, 'run_scenarios': False, 'scenarios_config': None, 'cross_dataset_eval': '../data/BJUT_Beijing', 'cross_dataset_name': 'BJUT_Beijing', 'run_abnormal_detection': True, 'abnormal_config': 'config/abnormal_detection_statistical.yaml'}
2025-11-04 17:21:42,659 - INFO - Enabled phases: ['abnormal']
2025-11-04 17:21:42,660 - INFO - Detected models: ['distilled', 'distilled_seed44', 'vanilla']
2025-11-04 17:21:42,660 - INFO - Models to process: ['distilled', 'distilled_seed44', 'vanilla']
2025-11-04 17:21:42,660 - INFO - OD sources: ['train', 'test']
2025-11-04 17:21:42,660 - INFO - â­ï¸  Skipping phase: generation
2025-11-04 17:21:42,660 - INFO - â­ï¸  Skipping phase: base_eval
2025-11-04 17:21:42,660 - INFO - â­ï¸  Skipping phase: cross_dataset
2025-11-04 17:21:42,660 - INFO - â­ï¸  Skipping phase: road_network_translate
2025-11-04 17:21:42,660 - INFO - 
======================================================================
2025-11-04 17:21:42,660 - INFO - ğŸš€ Running phase: abnormal
2025-11-04 17:21:42,660 - INFO - ======================================================================
2025-11-04 17:21:42,661 - INFO - ğŸ” Running abnormal detection...
2025-11-04 17:21:42,661 - INFO - 
ğŸ” Starting abnormal trajectory detection analysis...
2025-11-04 17:21:42,664 - INFO - Will analyze 2 dataset(s): ['Beijing', 'BJUT_Beijing']
2025-11-04 17:21:42,665 - INFO - 
======================================================================
2025-11-04 17:21:42,665 - INFO - ğŸ“Š Analyzing dataset: Beijing (main)
2025-11-04 17:21:42,665 - INFO - ======================================================================
2025-11-04 17:21:42,665 - INFO - 
ğŸ” Step 1: Detecting abnormal trajectories in real data...
2025-11-04 17:21:42,675 - INFO - 
  ğŸ“‚ Processing train data...
2025-11-04 17:21:42,675 - INFO -     ğŸ” Detecting abnormal trajectories in REAL data...
2025-11-04 17:21:42,675 - INFO - ğŸ” Starting abnormal trajectory analysis...
2025-11-04 17:21:42,675 - INFO - ğŸ“‚ Dataset: Beijing
2025-11-04 17:21:42,676 - INFO - ğŸ“‚ Input file: /home/matt/Dev/HOSER/data/Beijing/train.csv
2025-11-04 17:21:42,676 - INFO - âš™ï¸  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:21:42,684 - INFO - ğŸ’¾ Output directory: abnormal/Beijing/train/real_data
2025-11-04 17:21:42,690 - INFO - ğŸ” Detection method: wang_statistical
2025-11-04 17:21:42,690 - INFO - âš™ï¸  Loading configuration...
2025-11-04 17:21:42,690 - INFO - ğŸ“‚ Loading road network...
2025-11-04 17:21:44,528 - INFO - ğŸ“‚ Loading real trajectories...
2025-11-04 17:24:14,547 - INFO - âœ… Loaded 629380 trajectories
2025-11-04 17:24:14,547 - INFO - ğŸ“Š Using Wang et al. 2018 statistical detection
2025-11-04 17:24:14,554 - INFO - âœ… Found baselines: baselines_beijing.json
2025-11-04 17:24:14,554 - INFO - ğŸ“Š Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../baselines/baselines_beijing.json
2025-11-04 17:24:20,104 - INFO - âœ… Loaded baselines for 712,435 OD pairs
2025-11-04 17:24:20,104 - INFO -    OD pairs with â‰¥5 samples: 4,268 (0.6%)
2025-11-04 17:24:49,449 - INFO - ğŸ“Š Prepared 629380 trajectories for analysis
2025-11-04 17:24:51,480 - INFO - âœ… Wang Statistical Detector initialized
2025-11-04 17:24:51,481 - INFO -    Threshold strategy: hybrid
2025-11-04 17:24:51,481 - INFO -    Fixed thresholds: L_Ï=5000m, T_Ï=300s
2025-11-04 17:24:51,481 - INFO -    Statistical multipliers: Ïƒ_length=2.5, Ïƒ_time=2.5
2025-11-04 17:24:51,481 - INFO - ğŸ” Analyzing 629,380 trajectories...
2025-11-04 17:25:07,135 - ERROR -   âŒ Abnormal analysis failed for train: float() argument must be a string or a real number, not 'datetime.timedelta'
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/analyze_abnormal.py", line 502, in run_abnormal_analysis
    results = detector.detect_abnormal_trajectories(trajectories_df)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 525, in detect_abnormal_trajectories
    pattern, details = self.classify_trajectory(road_ids, timestamps)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 426, in classify_trajectory
    actual_time_sec = self.metrics.compute_travel_time(timestamps)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 280, in compute_travel_time
    return float(timestamps[-1] - timestamps[0])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'datetime.timedelta'
2025-11-04 17:25:08,333 - INFO - 
  ğŸ“‚ Processing test data...
2025-11-04 17:25:08,334 - INFO -     ğŸ” Detecting abnormal trajectories in REAL data...
2025-11-04 17:25:08,334 - INFO - ğŸ” Starting abnormal trajectory analysis...
2025-11-04 17:25:08,334 - INFO - ğŸ“‚ Dataset: Beijing
2025-11-04 17:25:08,334 - INFO - ğŸ“‚ Input file: /home/matt/Dev/HOSER/data/Beijing/test.csv
2025-11-04 17:25:08,334 - INFO - âš™ï¸  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:25:08,340 - INFO - ğŸ’¾ Output directory: abnormal/Beijing/test/real_data
2025-11-04 17:25:08,345 - INFO - ğŸ” Detection method: wang_statistical
2025-11-04 17:25:08,345 - INFO - âš™ï¸  Loading configuration...
2025-11-04 17:25:08,346 - INFO - ğŸ“‚ Loading road network...
2025-11-04 17:25:08,387 - INFO - ğŸ“‚ Loading real trajectories...
2025-11-04 17:25:50,497 - INFO - âœ… Loaded 179823 trajectories
2025-11-04 17:25:50,497 - INFO - ğŸ“Š Using Wang et al. 2018 statistical detection
2025-11-04 17:25:50,504 - INFO - âœ… Found baselines: baselines_beijing.json
2025-11-04 17:25:50,504 - INFO - ğŸ“Š Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../baselines/baselines_beijing.json
2025-11-04 17:25:55,878 - INFO - âœ… Loaded baselines for 712,435 OD pairs
2025-11-04 17:25:55,879 - INFO -    OD pairs with â‰¥5 samples: 4,268 (0.6%)
2025-11-04 17:26:03,177 - INFO - ğŸ“Š Prepared 179823 trajectories for analysis
2025-11-04 17:26:05,220 - INFO - âœ… Wang Statistical Detector initialized
2025-11-04 17:26:05,220 - INFO -    Threshold strategy: hybrid
2025-11-04 17:26:05,220 - INFO -    Fixed thresholds: L_Ï=5000m, T_Ï=300s
2025-11-04 17:26:05,220 - INFO -    Statistical multipliers: Ïƒ_length=2.5, Ïƒ_time=2.5
2025-11-04 17:26:05,220 - INFO - ğŸ” Analyzing 179,823 trajectories...
2025-11-04 17:26:10,651 - ERROR -   âŒ Abnormal analysis failed for test: float() argument must be a string or a real number, not 'datetime.timedelta'
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/analyze_abnormal.py", line 502, in run_abnormal_analysis
    results = detector.detect_abnormal_trajectories(trajectories_df)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 525, in detect_abnormal_trajectories
    pattern, details = self.classify_trajectory(road_ids, timestamps)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 426, in classify_trajectory
    actual_time_sec = self.metrics.compute_travel_time(timestamps)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 280, in compute_travel_time
    return float(timestamps[-1] - timestamps[0])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'datetime.timedelta'
2025-11-04 17:26:11,116 - INFO - 
âœ… Abnormal analysis complete for Beijing! Results in abnormal/Beijing/
2025-11-04 17:26:11,117 - INFO - 
======================================================================
2025-11-04 17:26:11,117 - INFO - ğŸ“Š Analyzing dataset: BJUT_Beijing (cross-dataset)
2025-11-04 17:26:11,117 - INFO - ======================================================================
2025-11-04 17:26:11,117 - INFO - 
ğŸ” Step 1: Detecting abnormal trajectories in real data...
2025-11-04 17:26:11,119 - INFO - 
  ğŸ“‚ Processing train data...
2025-11-04 17:26:11,119 - INFO -     ğŸ” Detecting abnormal trajectories in REAL data...
2025-11-04 17:26:11,120 - INFO - ğŸ” Starting abnormal trajectory analysis...
2025-11-04 17:26:11,120 - INFO - ğŸ“‚ Dataset: BJUT_Beijing
2025-11-04 17:26:11,120 - INFO - ğŸ“‚ Input file: /home/matt/Dev/HOSER/hoser-distill-optuna-6/../data/BJUT_Beijing/train.csv
2025-11-04 17:26:11,121 - INFO - âš™ï¸  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:26:11,140 - INFO - ğŸ’¾ Output directory: abnormal/BJUT_Beijing/train/real_data
2025-11-04 17:26:11,153 - INFO - ğŸ” Detection method: wang_statistical
2025-11-04 17:26:11,153 - INFO - âš™ï¸  Loading configuration...
2025-11-04 17:26:11,157 - INFO - ğŸ“‚ Loading road network...
2025-11-04 17:26:15,356 - INFO - ğŸ“‚ Loading real trajectories...
2025-11-04 17:26:21,863 - INFO - âœ… Loaded 27897 trajectories
2025-11-04 17:26:21,864 - INFO - ğŸ“Š Using Wang et al. 2018 statistical detection
2025-11-04 17:26:21,870 - INFO - âœ… Found baselines: baselines_beijing.json
2025-11-04 17:26:21,871 - INFO - ğŸ“Š Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../baselines/baselines_beijing.json
2025-11-04 17:26:26,772 - INFO - âœ… Loaded baselines for 712,435 OD pairs
2025-11-04 17:26:26,773 - INFO -    OD pairs with â‰¥5 samples: 4,268 (0.6%)
2025-11-04 17:26:27,631 - INFO - ğŸ“Š Prepared 27897 trajectories for analysis
2025-11-04 17:26:32,117 - INFO - âœ… Wang Statistical Detector initialized
2025-11-04 17:26:32,117 - INFO -    Threshold strategy: hybrid
2025-11-04 17:26:32,117 - INFO -    Fixed thresholds: L_Ï=5000m, T_Ï=300s
2025-11-04 17:26:32,117 - INFO -    Statistical multipliers: Ïƒ_length=2.5, Ïƒ_time=2.5
2025-11-04 17:26:32,117 - INFO - ğŸ” Analyzing 27,897 trajectories...
2025-11-04 17:26:32,567 - ERROR -   âŒ Abnormal analysis failed for train: float() argument must be a string or a real number, not 'datetime.timedelta'
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/analyze_abnormal.py", line 502, in run_abnormal_analysis
    results = detector.detect_abnormal_trajectories(trajectories_df)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 525, in detect_abnormal_trajectories
    pattern, details = self.classify_trajectory(road_ids, timestamps)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 426, in classify_trajectory
    actual_time_sec = self.metrics.compute_travel_time(timestamps)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 280, in compute_travel_time
    return float(timestamps[-1] - timestamps[0])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'datetime.timedelta'
2025-11-04 17:26:32,849 - INFO - 
  ğŸ“‚ Processing test data...
2025-11-04 17:26:32,850 - INFO -     ğŸ” Detecting abnormal trajectories in REAL data...
2025-11-04 17:26:32,850 - INFO - ğŸ” Starting abnormal trajectory analysis...
2025-11-04 17:26:32,850 - INFO - ğŸ“‚ Dataset: BJUT_Beijing
2025-11-04 17:26:32,851 - INFO - ğŸ“‚ Input file: /home/matt/Dev/HOSER/hoser-distill-optuna-6/../data/BJUT_Beijing/test.csv
2025-11-04 17:26:32,851 - INFO - âš™ï¸  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:26:32,873 - INFO - ğŸ’¾ Output directory: abnormal/BJUT_Beijing/test/real_data
2025-11-04 17:26:32,884 - INFO - ğŸ” Detection method: wang_statistical
2025-11-04 17:26:32,884 - INFO - âš™ï¸  Loading configuration...
2025-11-04 17:26:32,888 - INFO - ğŸ“‚ Loading road network...
2025-11-04 17:26:32,992 - INFO - ğŸ“‚ Loading real trajectories...
2025-11-04 17:26:34,384 - INFO - âœ… Loaded 5979 trajectories
2025-11-04 17:26:34,384 - INFO - ğŸ“Š Using Wang et al. 2018 statistical detection
2025-11-04 17:26:34,391 - INFO - âœ… Found baselines: baselines_beijing.json
2025-11-04 17:26:34,391 - INFO - ğŸ“Š Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../baselines/baselines_beijing.json
2025-11-04 17:26:39,134 - INFO - âœ… Loaded baselines for 712,435 OD pairs
2025-11-04 17:26:39,134 - INFO -    OD pairs with â‰¥5 samples: 4,268 (0.6%)
2025-11-04 17:26:39,334 - INFO - ğŸ“Š Prepared 5979 trajectories for analysis
2025-11-04 17:26:43,621 - INFO - âœ… Wang Statistical Detector initialized
2025-11-04 17:26:43,621 - INFO -    Threshold strategy: hybrid
2025-11-04 17:26:43,621 - INFO -    Fixed thresholds: L_Ï=5000m, T_Ï=300s
2025-11-04 17:26:43,622 - INFO -    Statistical multipliers: Ïƒ_length=2.5, Ïƒ_time=2.5
2025-11-04 17:26:43,622 - INFO - ğŸ” Analyzing 5,979 trajectories...
2025-11-04 17:26:43,717 - ERROR -   âŒ Abnormal analysis failed for test: float() argument must be a string or a real number, not 'datetime.timedelta'
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/analyze_abnormal.py", line 502, in run_abnormal_analysis
    results = detector.detect_abnormal_trajectories(trajectories_df)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 525, in detect_abnormal_trajectories
    pattern, details = self.classify_trajectory(road_ids, timestamps)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 426, in classify_trajectory
    actual_time_sec = self.metrics.compute_travel_time(timestamps)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/detect_abnormal_statistical.py", line 280, in compute_travel_time
    return float(timestamps[-1] - timestamps[0])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: float() argument must be a string or a real number, not 'datetime.timedelta'
2025-11-04 17:26:43,951 - INFO - 
âœ… Abnormal analysis complete for BJUT_Beijing! Results in abnormal/BJUT_Beijing/
2025-11-04 17:26:43,951 - INFO - âœ… Phase abnormal completed
2025-11-04 17:26:43,951 - INFO - â­ï¸  Skipping phase: abnormal_od_extract
2025-11-04 17:26:43,951 - INFO - â­ï¸  Skipping phase: abnormal_od_generate
2025-11-04 17:26:43,951 - INFO - â­ï¸  Skipping phase: abnormal_od_evaluate
2025-11-04 17:26:43,951 - INFO - â­ï¸  Skipping phase: scenarios
2025-11-04 17:26:43,951 - INFO - 
âœ… Pipeline completed successfully!
2025-11-04 17:26:43,951 - INFO - âœ… Pipeline completed successfully!
ğŸ“‚ Loading road network...
ğŸ“ Calculating road centroids for 40,060 roads...
âœ… Road network loaded: 40,060 valid roads
ğŸ“‚ Loading trajectories from /home/matt/Dev/HOSER/data/Beijing/train.csv...
ğŸ”„ Parsing 629,380 trajectories...
âœ… Loaded 629,380 valid trajectories (dropped 0)
ğŸ“‚ Using cached road network...
ğŸ“‚ Loading trajectories from /home/matt/Dev/HOSER/data/Beijing/test.csv...
ğŸ”„ Parsing 179,823 trajectories...
âœ… Loaded 179,823 valid trajectories (dropped 0)
ğŸ“‚ Loading road network...
ğŸ“ Calculating road centroids for 87,481 roads...
âœ… Road network loaded: 87,481 valid roads
ğŸ“‚ Loading trajectories from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../data/BJUT_Beijing/train.csv...
ğŸ”„ Parsing 27,897 trajectories...
âœ… Loaded 27,897 valid trajectories (dropped 0)
ğŸ“‚ Using cached road network...
ğŸ“‚ Loading trajectories from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../data/BJUT_Beijing/test.csv...
ğŸ”„ Parsing 5,979 trajectories...
âœ… Loaded 5,979 valid trajectories (dropped 0)
