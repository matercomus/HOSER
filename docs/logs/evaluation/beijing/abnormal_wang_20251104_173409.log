2025-11-04 17:34:17,226 - INFO - Running only phases: {'abnormal'}
2025-11-04 17:34:17,227 - INFO - Working directory: /home/matt/Dev/HOSER/hoser-distill-optuna-6
2025-11-04 17:34:17,227 - INFO - Validating pipeline configuration...
2025-11-04 17:34:17,233 - INFO - âœ“ Cross-dataset evaluation enabled: BJUT_Beijing
2025-11-04 17:34:17,278 - INFO - Configuration validation passed
2025-11-04 17:34:17,283 - INFO - Starting HOSER Distillation Evaluation Pipeline
2025-11-04 17:34:17,283 - INFO - Configuration: {'eval_dir': PosixPath('/home/matt/Dev/HOSER/hoser-distill-optuna-6'), 'wandb_project': 'hoser-distill-optuna-6', 'dataset': 'Beijing', 'cuda_device': 0, 'num_gene': 5000, 'seed': 42, 'models': [], 'od_sources': ['train', 'test'], 'phases': {'abnormal'}, 'force': False, 'enable_wandb': True, 'verbose': False, 'beam_width': 4, 'grid_size': 0.001, 'edr_eps': 100.0, 'background_sync': True, 'run_scenarios': False, 'scenarios_config': None, 'cross_dataset_eval': '../data/BJUT_Beijing', 'cross_dataset_name': 'BJUT_Beijing', 'run_abnormal_detection': True, 'abnormal_config': 'config/abnormal_detection_statistical.yaml'}
2025-11-04 17:34:17,284 - INFO - Enabled phases: ['abnormal']
2025-11-04 17:34:17,284 - INFO - Detected models: ['distilled', 'distilled_seed44', 'vanilla']
2025-11-04 17:34:17,284 - INFO - Models to process: ['distilled', 'distilled_seed44', 'vanilla']
2025-11-04 17:34:17,284 - INFO - OD sources: ['train', 'test']
2025-11-04 17:34:17,284 - INFO - â­ï¸  Skipping phase: generation
2025-11-04 17:34:17,284 - INFO - â­ï¸  Skipping phase: base_eval
2025-11-04 17:34:17,285 - INFO - â­ï¸  Skipping phase: cross_dataset
2025-11-04 17:34:17,285 - INFO - â­ï¸  Skipping phase: road_network_translate
2025-11-04 17:34:17,285 - INFO - 
======================================================================
2025-11-04 17:34:17,285 - INFO - ğŸš€ Running phase: abnormal
2025-11-04 17:34:17,285 - INFO - ======================================================================
2025-11-04 17:34:17,285 - INFO - ğŸ” Running abnormal detection...
2025-11-04 17:34:17,285 - INFO - 
ğŸ” Starting abnormal trajectory detection analysis...
2025-11-04 17:34:17,291 - INFO - Will analyze 2 dataset(s): ['Beijing', 'BJUT_Beijing']
2025-11-04 17:34:17,291 - INFO - 
======================================================================
2025-11-04 17:34:17,291 - INFO - ğŸ“Š Analyzing dataset: Beijing (main)
2025-11-04 17:34:17,292 - INFO - ======================================================================
2025-11-04 17:34:17,292 - INFO - 
ğŸ” Step 1: Detecting abnormal trajectories in real data...
2025-11-04 17:34:17,303 - INFO - 
  ğŸ“‚ Processing train data...
2025-11-04 17:34:17,303 - INFO -     ğŸ” Detecting abnormal trajectories in REAL data...
2025-11-04 17:34:17,304 - INFO - ğŸ” Starting abnormal trajectory analysis...
2025-11-04 17:34:17,304 - INFO - ğŸ“‚ Dataset: Beijing
2025-11-04 17:34:17,304 - INFO - ğŸ“‚ Input file: /home/matt/Dev/HOSER/data/Beijing/train.csv
2025-11-04 17:34:17,304 - INFO - âš™ï¸  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:34:17,310 - INFO - ğŸ’¾ Output directory: abnormal/Beijing/train/real_data
2025-11-04 17:34:17,317 - INFO - ğŸ” Detection method: wang_statistical
2025-11-04 17:34:17,317 - INFO - âš™ï¸  Loading configuration...
2025-11-04 17:34:17,317 - INFO - ğŸ“‚ Loading road network...
2025-11-04 17:34:19,227 - INFO - ğŸ“‚ Loading real trajectories...
2025-11-04 17:36:54,776 - INFO - âœ… Loaded 629380 trajectories
2025-11-04 17:36:54,776 - INFO - ğŸ“Š Using Wang et al. 2018 statistical detection
2025-11-04 17:36:54,783 - INFO - âœ… Found baselines: baselines_beijing.json
2025-11-04 17:36:54,783 - INFO - ğŸ“Š Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../baselines/baselines_beijing.json
2025-11-04 17:37:00,417 - INFO - âœ… Loaded baselines for 712,435 OD pairs
2025-11-04 17:37:00,418 - INFO -    OD pairs with â‰¥5 samples: 4,268 (0.6%)
2025-11-04 17:37:46,093 - INFO - ğŸ“Š Prepared 629380 trajectories for analysis
2025-11-04 17:37:48,365 - INFO - âœ… Wang Statistical Detector initialized
2025-11-04 17:37:48,365 - INFO -    Threshold strategy: hybrid
2025-11-04 17:37:48,365 - INFO -    Fixed thresholds: L_Ï=5000m, T_Ï=300s
2025-11-04 17:37:48,365 - INFO -    Statistical multipliers: Ïƒ_length=2.5, Ïƒ_time=2.5
2025-11-04 17:37:48,365 - INFO - ğŸ” Analyzing 629,380 trajectories...
2025-11-04 17:37:56,320 - INFO -    Processed 10,000 / 629,380 trajectories...
2025-11-04 17:37:57,619 - INFO -    Processed 20,000 / 629,380 trajectories...
2025-11-04 17:37:58,877 - INFO -    Processed 30,000 / 629,380 trajectories...
2025-11-04 17:38:00,228 - INFO -    Processed 40,000 / 629,380 trajectories...
2025-11-04 17:38:01,461 - INFO -    Processed 50,000 / 629,380 trajectories...
2025-11-04 17:38:02,778 - INFO -    Processed 60,000 / 629,380 trajectories...
2025-11-04 17:38:04,039 - INFO -    Processed 70,000 / 629,380 trajectories...
2025-11-04 17:38:05,288 - INFO -    Processed 80,000 / 629,380 trajectories...
2025-11-04 17:38:06,591 - INFO -    Processed 90,000 / 629,380 trajectories...
2025-11-04 17:38:07,847 - INFO -    Processed 100,000 / 629,380 trajectories...
2025-11-04 17:38:09,123 - INFO -    Processed 110,000 / 629,380 trajectories...
2025-11-04 17:38:10,391 - INFO -    Processed 120,000 / 629,380 trajectories...
2025-11-04 17:38:11,639 - INFO -    Processed 130,000 / 629,380 trajectories...
2025-11-04 17:38:12,931 - INFO -    Processed 140,000 / 629,380 trajectories...
2025-11-04 17:38:14,223 - INFO -    Processed 150,000 / 629,380 trajectories...
2025-11-04 17:38:15,497 - INFO -    Processed 160,000 / 629,380 trajectories...
2025-11-04 17:38:16,776 - INFO -    Processed 170,000 / 629,380 trajectories...
2025-11-04 17:38:18,036 - INFO -    Processed 180,000 / 629,380 trajectories...
2025-11-04 17:38:19,368 - INFO -    Processed 190,000 / 629,380 trajectories...
2025-11-04 17:38:20,630 - INFO -    Processed 200,000 / 629,380 trajectories...
2025-11-04 17:38:21,882 - INFO -    Processed 210,000 / 629,380 trajectories...
2025-11-04 17:38:23,183 - INFO -    Processed 220,000 / 629,380 trajectories...
2025-11-04 17:38:24,443 - INFO -    Processed 230,000 / 629,380 trajectories...
2025-11-04 17:38:25,701 - INFO -    Processed 240,000 / 629,380 trajectories...
2025-11-04 17:38:26,987 - INFO -    Processed 250,000 / 629,380 trajectories...
2025-11-04 17:38:28,295 - INFO -    Processed 260,000 / 629,380 trajectories...
2025-11-04 17:38:29,569 - INFO -    Processed 270,000 / 629,380 trajectories...
2025-11-04 17:38:30,856 - INFO -    Processed 280,000 / 629,380 trajectories...
2025-11-04 17:38:32,157 - INFO -    Processed 290,000 / 629,380 trajectories...
2025-11-04 17:38:33,430 - INFO -    Processed 300,000 / 629,380 trajectories...
2025-11-04 17:38:34,688 - INFO -    Processed 310,000 / 629,380 trajectories...
2025-11-04 17:38:35,957 - INFO -    Processed 320,000 / 629,380 trajectories...
2025-11-04 17:38:37,273 - INFO -    Processed 330,000 / 629,380 trajectories...
2025-11-04 17:38:38,553 - INFO -    Processed 340,000 / 629,380 trajectories...
2025-11-04 17:38:39,885 - INFO -    Processed 350,000 / 629,380 trajectories...
2025-11-04 17:38:41,155 - INFO -    Processed 360,000 / 629,380 trajectories...
2025-11-04 17:38:42,448 - INFO -    Processed 370,000 / 629,380 trajectories...
2025-11-04 17:38:43,679 - INFO -    Processed 380,000 / 629,380 trajectories...
2025-11-04 17:38:44,952 - INFO -    Processed 390,000 / 629,380 trajectories...
2025-11-04 17:38:46,246 - INFO -    Processed 400,000 / 629,380 trajectories...
2025-11-04 17:38:47,549 - INFO -    Processed 410,000 / 629,380 trajectories...
2025-11-04 17:38:48,832 - INFO -    Processed 420,000 / 629,380 trajectories...
2025-11-04 17:38:50,224 - INFO -    Processed 430,000 / 629,380 trajectories...
2025-11-04 17:38:51,484 - INFO -    Processed 440,000 / 629,380 trajectories...
2025-11-04 17:38:52,769 - INFO -    Processed 450,000 / 629,380 trajectories...
2025-11-04 17:38:54,048 - INFO -    Processed 460,000 / 629,380 trajectories...
2025-11-04 17:38:55,292 - INFO -    Processed 470,000 / 629,380 trajectories...
2025-11-04 17:38:56,578 - INFO -    Processed 480,000 / 629,380 trajectories...
2025-11-04 17:38:57,854 - INFO -    Processed 490,000 / 629,380 trajectories...
2025-11-04 17:38:59,145 - INFO -    Processed 500,000 / 629,380 trajectories...
2025-11-04 17:39:00,425 - INFO -    Processed 510,000 / 629,380 trajectories...
2025-11-04 17:39:01,705 - INFO -    Processed 520,000 / 629,380 trajectories...
2025-11-04 17:39:03,016 - INFO -    Processed 530,000 / 629,380 trajectories...
2025-11-04 17:39:04,298 - INFO -    Processed 540,000 / 629,380 trajectories...
2025-11-04 17:39:05,588 - INFO -    Processed 550,000 / 629,380 trajectories...
2025-11-04 17:39:06,880 - INFO -    Processed 560,000 / 629,380 trajectories...
2025-11-04 17:39:08,149 - INFO -    Processed 570,000 / 629,380 trajectories...
2025-11-04 17:39:09,492 - INFO -    Processed 580,000 / 629,380 trajectories...
2025-11-04 17:39:10,789 - INFO -    Processed 590,000 / 629,380 trajectories...
2025-11-04 17:39:13,907 - INFO -    Processed 600,000 / 629,380 trajectories...
2025-11-04 17:39:15,153 - INFO -    Processed 610,000 / 629,380 trajectories...
2025-11-04 17:39:16,444 - INFO -    Processed 620,000 / 629,380 trajectories...
2025-11-04 17:39:17,677 - INFO - ğŸ“Š Detection Results:
2025-11-04 17:39:17,677 - INFO -    Total trajectories: 629,380
2025-11-04 17:39:17,677 - INFO -    Abp1 (Normal): 490,846
2025-11-04 17:39:17,677 - INFO -    Abp2 (Temporal delay): 138,534
2025-11-04 17:39:17,677 - INFO -    Abp3 (Route deviation): 0
2025-11-04 17:39:17,677 - INFO -    Abp4 (Both deviations): 0
2025-11-04 17:39:17,677 - INFO -    Abnormal rate: 22.01%
2025-11-04 17:39:17,677 - INFO - ğŸ“Š Baseline usage:
2025-11-04 17:39:17,677 - INFO -    OD-specific: 25,536
2025-11-04 17:39:17,677 - INFO -    Global fallback: 603,844
2025-11-04 17:39:18,557 - INFO - ğŸ’¾ Saving detection results...
2025-11-04 17:39:18,785 - INFO - âœ… Saved detection results to abnormal/Beijing/train/real_data/detection_results.json
2025-11-04 17:39:18,786 - INFO - âœ… Saved statistics to abnormal/Beijing/train/real_data/statistics_by_category.json
2025-11-04 17:39:18,786 - ERROR -   âŒ Abnormal analysis failed for train: cannot access local variable 'config' where it is not associated with a value
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/analyze_abnormal.py", line 631, in run_abnormal_analysis
    if config.analysis_config.get("save_trajectory_samples", False):
       ^^^^^^
UnboundLocalError: cannot access local variable 'config' where it is not associated with a value
2025-11-04 17:39:19,154 - INFO - 
  ğŸ“‚ Processing test data...
2025-11-04 17:39:19,154 - INFO -     ğŸ” Detecting abnormal trajectories in REAL data...
2025-11-04 17:39:19,155 - INFO - ğŸ” Starting abnormal trajectory analysis...
2025-11-04 17:39:19,155 - INFO - ğŸ“‚ Dataset: Beijing
2025-11-04 17:39:19,155 - INFO - ğŸ“‚ Input file: /home/matt/Dev/HOSER/data/Beijing/test.csv
2025-11-04 17:39:19,155 - INFO - âš™ï¸  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:39:19,162 - INFO - ğŸ’¾ Output directory: abnormal/Beijing/test/real_data
2025-11-04 17:39:19,183 - INFO - ğŸ” Detection method: wang_statistical
2025-11-04 17:39:19,184 - INFO - âš™ï¸  Loading configuration...
2025-11-04 17:39:19,184 - INFO - ğŸ“‚ Loading road network...
2025-11-04 17:39:19,222 - INFO - ğŸ“‚ Loading real trajectories...
2025-11-04 17:40:02,076 - INFO - âœ… Loaded 179823 trajectories
2025-11-04 17:40:02,077 - INFO - ğŸ“Š Using Wang et al. 2018 statistical detection
2025-11-04 17:40:02,098 - INFO - âœ… Found baselines: baselines_beijing.json
2025-11-04 17:40:02,099 - INFO - ğŸ“Š Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../baselines/baselines_beijing.json
2025-11-04 17:40:07,150 - INFO - âœ… Loaded baselines for 712,435 OD pairs
2025-11-04 17:40:07,150 - INFO -    OD pairs with â‰¥5 samples: 4,268 (0.6%)
2025-11-04 17:40:17,345 - INFO - ğŸ“Š Prepared 179823 trajectories for analysis
2025-11-04 17:40:19,484 - INFO - âœ… Wang Statistical Detector initialized
2025-11-04 17:40:19,484 - INFO -    Threshold strategy: hybrid
2025-11-04 17:40:19,484 - INFO -    Fixed thresholds: L_Ï=5000m, T_Ï=300s
2025-11-04 17:40:19,484 - INFO -    Statistical multipliers: Ïƒ_length=2.5, Ïƒ_time=2.5
2025-11-04 17:40:19,485 - INFO - ğŸ” Analyzing 179,823 trajectories...
2025-11-04 17:40:23,805 - INFO -    Processed 10,000 / 179,823 trajectories...
2025-11-04 17:40:25,120 - INFO -    Processed 20,000 / 179,823 trajectories...
2025-11-04 17:40:26,416 - INFO -    Processed 30,000 / 179,823 trajectories...
2025-11-04 17:40:27,730 - INFO -    Processed 40,000 / 179,823 trajectories...
2025-11-04 17:40:29,000 - INFO -    Processed 50,000 / 179,823 trajectories...
2025-11-04 17:40:30,283 - INFO -    Processed 60,000 / 179,823 trajectories...
2025-11-04 17:40:31,563 - INFO -    Processed 70,000 / 179,823 trajectories...
2025-11-04 17:40:32,900 - INFO -    Processed 80,000 / 179,823 trajectories...
2025-11-04 17:40:34,201 - INFO -    Processed 90,000 / 179,823 trajectories...
2025-11-04 17:40:35,466 - INFO -    Processed 100,000 / 179,823 trajectories...
2025-11-04 17:40:36,813 - INFO -    Processed 110,000 / 179,823 trajectories...
2025-11-04 17:40:38,133 - INFO -    Processed 120,000 / 179,823 trajectories...
2025-11-04 17:40:39,430 - INFO -    Processed 130,000 / 179,823 trajectories...
2025-11-04 17:40:40,713 - INFO -    Processed 140,000 / 179,823 trajectories...
2025-11-04 17:40:42,053 - INFO -    Processed 150,000 / 179,823 trajectories...
2025-11-04 17:40:43,327 - INFO -    Processed 160,000 / 179,823 trajectories...
2025-11-04 17:40:44,579 - INFO -    Processed 170,000 / 179,823 trajectories...
2025-11-04 17:40:45,821 - INFO - ğŸ“Š Detection Results:
2025-11-04 17:40:45,822 - INFO -    Total trajectories: 179,823
2025-11-04 17:40:45,822 - INFO -    Abp1 (Normal): 140,170
2025-11-04 17:40:45,822 - INFO -    Abp2 (Temporal delay): 39,653
2025-11-04 17:40:45,822 - INFO -    Abp3 (Route deviation): 0
2025-11-04 17:40:45,822 - INFO -    Abp4 (Both deviations): 0
2025-11-04 17:40:45,822 - INFO -    Abnormal rate: 22.05%
2025-11-04 17:40:45,822 - INFO - ğŸ“Š Baseline usage:
2025-11-04 17:40:45,822 - INFO -    OD-specific: 7,151
2025-11-04 17:40:45,822 - INFO -    Global fallback: 172,672
2025-11-04 17:40:46,067 - INFO - ğŸ’¾ Saving detection results...
2025-11-04 17:40:46,126 - INFO - âœ… Saved detection results to abnormal/Beijing/test/real_data/detection_results.json
2025-11-04 17:40:46,127 - INFO - âœ… Saved statistics to abnormal/Beijing/test/real_data/statistics_by_category.json
2025-11-04 17:40:46,127 - ERROR -   âŒ Abnormal analysis failed for test: cannot access local variable 'config' where it is not associated with a value
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/analyze_abnormal.py", line 631, in run_abnormal_analysis
    if config.analysis_config.get("save_trajectory_samples", False):
       ^^^^^^
UnboundLocalError: cannot access local variable 'config' where it is not associated with a value
2025-11-04 17:40:46,387 - INFO - 
âœ… Abnormal analysis complete for Beijing! Results in abnormal/Beijing/
2025-11-04 17:40:46,387 - INFO - 
======================================================================
2025-11-04 17:40:46,388 - INFO - ğŸ“Š Analyzing dataset: BJUT_Beijing (cross-dataset)
2025-11-04 17:40:46,388 - INFO - ======================================================================
2025-11-04 17:40:46,388 - INFO - 
ğŸ” Step 1: Detecting abnormal trajectories in real data...
2025-11-04 17:40:46,389 - INFO - 
  ğŸ“‚ Processing train data...
2025-11-04 17:40:46,389 - INFO -     ğŸ” Detecting abnormal trajectories in REAL data...
2025-11-04 17:40:46,389 - INFO - ğŸ” Starting abnormal trajectory analysis...
2025-11-04 17:40:46,389 - INFO - ğŸ“‚ Dataset: BJUT_Beijing
2025-11-04 17:40:46,389 - INFO - ğŸ“‚ Input file: /home/matt/Dev/HOSER/hoser-distill-optuna-6/../data/BJUT_Beijing/train.csv
2025-11-04 17:40:46,389 - INFO - âš™ï¸  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:40:46,395 - INFO - ğŸ’¾ Output directory: abnormal/BJUT_Beijing/train/real_data
2025-11-04 17:40:46,401 - INFO - ğŸ” Detection method: wang_statistical
2025-11-04 17:40:46,402 - INFO - âš™ï¸  Loading configuration...
2025-11-04 17:40:46,406 - INFO - ğŸ“‚ Loading road network...
2025-11-04 17:40:50,743 - INFO - ğŸ“‚ Loading real trajectories...
2025-11-04 17:40:57,062 - INFO - âœ… Loaded 27897 trajectories
2025-11-04 17:40:57,062 - INFO - ğŸ“Š Using Wang et al. 2018 statistical detection
2025-11-04 17:40:57,068 - INFO - âœ… Found baselines: baselines_beijing.json
2025-11-04 17:40:57,069 - INFO - ğŸ“Š Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../baselines/baselines_beijing.json
2025-11-04 17:41:02,109 - INFO - âœ… Loaded baselines for 712,435 OD pairs
2025-11-04 17:41:02,109 - INFO -    OD pairs with â‰¥5 samples: 4,268 (0.6%)
2025-11-04 17:41:03,534 - INFO - ğŸ“Š Prepared 27897 trajectories for analysis
2025-11-04 17:41:08,270 - INFO - âœ… Wang Statistical Detector initialized
2025-11-04 17:41:08,271 - INFO -    Threshold strategy: hybrid
2025-11-04 17:41:08,271 - INFO -    Fixed thresholds: L_Ï=5000m, T_Ï=300s
2025-11-04 17:41:08,271 - INFO -    Statistical multipliers: Ïƒ_length=2.5, Ïƒ_time=2.5
2025-11-04 17:41:08,271 - INFO - ğŸ” Analyzing 27,897 trajectories...
2025-11-04 17:41:09,595 - INFO -    Processed 10,000 / 27,897 trajectories...
2025-11-04 17:41:10,738 - INFO -    Processed 20,000 / 27,897 trajectories...
2025-11-04 17:41:11,622 - INFO - ğŸ“Š Detection Results:
2025-11-04 17:41:11,623 - INFO -    Total trajectories: 27,897
2025-11-04 17:41:11,623 - INFO -    Abp1 (Normal): 27,795
2025-11-04 17:41:11,623 - INFO -    Abp2 (Temporal delay): 102
2025-11-04 17:41:11,623 - INFO -    Abp3 (Route deviation): 0
2025-11-04 17:41:11,623 - INFO -    Abp4 (Both deviations): 0
2025-11-04 17:41:11,623 - INFO -    Abnormal rate: 0.37%
2025-11-04 17:41:11,623 - INFO - ğŸ“Š Baseline usage:
2025-11-04 17:41:11,623 - INFO -    OD-specific: 0
2025-11-04 17:41:11,623 - INFO -    Global fallback: 27,897
2025-11-04 17:41:11,671 - INFO - ğŸ’¾ Saving detection results...
2025-11-04 17:41:11,672 - INFO - âœ… Saved detection results to abnormal/BJUT_Beijing/train/real_data/detection_results.json
2025-11-04 17:41:11,673 - INFO - âœ… Saved statistics to abnormal/BJUT_Beijing/train/real_data/statistics_by_category.json
2025-11-04 17:41:11,673 - ERROR -   âŒ Abnormal analysis failed for train: cannot access local variable 'config' where it is not associated with a value
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/analyze_abnormal.py", line 631, in run_abnormal_analysis
    if config.analysis_config.get("save_trajectory_samples", False):
       ^^^^^^
UnboundLocalError: cannot access local variable 'config' where it is not associated with a value
2025-11-04 17:41:11,896 - INFO - 
  ğŸ“‚ Processing test data...
2025-11-04 17:41:11,896 - INFO -     ğŸ” Detecting abnormal trajectories in REAL data...
2025-11-04 17:41:11,897 - INFO - ğŸ” Starting abnormal trajectory analysis...
2025-11-04 17:41:11,897 - INFO - ğŸ“‚ Dataset: BJUT_Beijing
2025-11-04 17:41:11,897 - INFO - ğŸ“‚ Input file: /home/matt/Dev/HOSER/hoser-distill-optuna-6/../data/BJUT_Beijing/test.csv
2025-11-04 17:41:11,897 - INFO - âš™ï¸  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:41:11,902 - INFO - ğŸ’¾ Output directory: abnormal/BJUT_Beijing/test/real_data
2025-11-04 17:41:11,908 - INFO - ğŸ” Detection method: wang_statistical
2025-11-04 17:41:11,908 - INFO - âš™ï¸  Loading configuration...
2025-11-04 17:41:11,913 - INFO - ğŸ“‚ Loading road network...
2025-11-04 17:41:12,018 - INFO - ğŸ“‚ Loading real trajectories...
2025-11-04 17:41:13,444 - INFO - âœ… Loaded 5979 trajectories
2025-11-04 17:41:13,444 - INFO - ğŸ“Š Using Wang et al. 2018 statistical detection
2025-11-04 17:41:13,450 - INFO - âœ… Found baselines: baselines_beijing.json
2025-11-04 17:41:13,450 - INFO - ğŸ“Š Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../baselines/baselines_beijing.json
2025-11-04 17:41:18,346 - INFO - âœ… Loaded baselines for 712,435 OD pairs
2025-11-04 17:41:18,347 - INFO -    OD pairs with â‰¥5 samples: 4,268 (0.6%)
2025-11-04 17:41:18,669 - INFO - ğŸ“Š Prepared 5979 trajectories for analysis
2025-11-04 17:41:23,336 - INFO - âœ… Wang Statistical Detector initialized
2025-11-04 17:41:23,336 - INFO -    Threshold strategy: hybrid
2025-11-04 17:41:23,336 - INFO -    Fixed thresholds: L_Ï=5000m, T_Ï=300s
2025-11-04 17:41:23,336 - INFO -    Statistical multipliers: Ïƒ_length=2.5, Ïƒ_time=2.5
2025-11-04 17:41:23,336 - INFO - ğŸ” Analyzing 5,979 trajectories...
2025-11-04 17:41:25,370 - INFO - ğŸ“Š Detection Results:
2025-11-04 17:41:25,370 - INFO -    Total trajectories: 5,979
2025-11-04 17:41:25,370 - INFO -    Abp1 (Normal): 5,955
2025-11-04 17:41:25,370 - INFO -    Abp2 (Temporal delay): 24
2025-11-04 17:41:25,370 - INFO -    Abp3 (Route deviation): 0
2025-11-04 17:41:25,370 - INFO -    Abp4 (Both deviations): 0
2025-11-04 17:41:25,370 - INFO -    Abnormal rate: 0.40%
2025-11-04 17:41:25,371 - INFO - ğŸ“Š Baseline usage:
2025-11-04 17:41:25,371 - INFO -    OD-specific: 0
2025-11-04 17:41:25,371 - INFO -    Global fallback: 5,979
2025-11-04 17:41:25,377 - INFO - ğŸ’¾ Saving detection results...
2025-11-04 17:41:25,377 - INFO - âœ… Saved detection results to abnormal/BJUT_Beijing/test/real_data/detection_results.json
2025-11-04 17:41:25,378 - INFO - âœ… Saved statistics to abnormal/BJUT_Beijing/test/real_data/statistics_by_category.json
2025-11-04 17:41:25,378 - ERROR -   âŒ Abnormal analysis failed for test: cannot access local variable 'config' where it is not associated with a value
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/analyze_abnormal.py", line 631, in run_abnormal_analysis
    if config.analysis_config.get("save_trajectory_samples", False):
       ^^^^^^
UnboundLocalError: cannot access local variable 'config' where it is not associated with a value
2025-11-04 17:41:25,619 - INFO - 
âœ… Abnormal analysis complete for BJUT_Beijing! Results in abnormal/BJUT_Beijing/
2025-11-04 17:41:25,619 - INFO - âœ… Phase abnormal completed
2025-11-04 17:41:25,619 - INFO - â­ï¸  Skipping phase: abnormal_od_extract
2025-11-04 17:41:25,619 - INFO - â­ï¸  Skipping phase: abnormal_od_generate
2025-11-04 17:41:25,619 - INFO - â­ï¸  Skipping phase: abnormal_od_evaluate
2025-11-04 17:41:25,619 - INFO - â­ï¸  Skipping phase: scenarios
2025-11-04 17:41:25,619 - INFO - 
âœ… Pipeline completed successfully!
2025-11-04 17:41:25,619 - INFO - âœ… Pipeline completed successfully!
ğŸ“‚ Loading road network...
ğŸ“ Calculating road centroids for 40,060 roads...
âœ… Road network loaded: 40,060 valid roads
ğŸ“‚ Loading trajectories from /home/matt/Dev/HOSER/data/Beijing/train.csv...
ğŸ”„ Parsing 629,380 trajectories...
âœ… Loaded 629,380 valid trajectories (dropped 0)
ğŸ“‚ Using cached road network...
ğŸ“‚ Loading trajectories from /home/matt/Dev/HOSER/data/Beijing/test.csv...
ğŸ”„ Parsing 179,823 trajectories...
âœ… Loaded 179,823 valid trajectories (dropped 0)
ğŸ“‚ Loading road network...
ğŸ“ Calculating road centroids for 87,481 roads...
âœ… Road network loaded: 87,481 valid roads
ğŸ“‚ Loading trajectories from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../data/BJUT_Beijing/train.csv...
ğŸ”„ Parsing 27,897 trajectories...
âœ… Loaded 27,897 valid trajectories (dropped 0)
ğŸ“‚ Using cached road network...
ğŸ“‚ Loading trajectories from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../data/BJUT_Beijing/test.csv...
ğŸ”„ Parsing 5,979 trajectories...
âœ… Loaded 5,979 valid trajectories (dropped 0)
