2025-11-04 17:44:04,448 - INFO - Running only phases: {'abnormal'}
2025-11-04 17:44:04,450 - INFO - Working directory: /home/matt/Dev/HOSER/hoser-distill-optuna-6
2025-11-04 17:44:04,450 - INFO - Validating pipeline configuration...
2025-11-04 17:44:04,455 - INFO - ‚úì Cross-dataset evaluation enabled: BJUT_Beijing
2025-11-04 17:44:04,557 - INFO - Configuration validation passed
2025-11-04 17:44:04,569 - INFO - Starting HOSER Distillation Evaluation Pipeline
2025-11-04 17:44:04,569 - INFO - Configuration: {'eval_dir': PosixPath('/home/matt/Dev/HOSER/hoser-distill-optuna-6'), 'wandb_project': 'hoser-distill-optuna-6', 'dataset': 'Beijing', 'cuda_device': 0, 'num_gene': 5000, 'seed': 42, 'models': [], 'od_sources': ['train', 'test'], 'phases': {'abnormal'}, 'force': False, 'enable_wandb': True, 'verbose': False, 'beam_width': 4, 'grid_size': 0.001, 'edr_eps': 100.0, 'background_sync': True, 'run_scenarios': False, 'scenarios_config': None, 'cross_dataset_eval': '../data/BJUT_Beijing', 'cross_dataset_name': 'BJUT_Beijing', 'run_abnormal_detection': True, 'abnormal_config': 'config/abnormal_detection_statistical.yaml'}
2025-11-04 17:44:04,570 - INFO - Enabled phases: ['abnormal']
2025-11-04 17:44:04,571 - INFO - Detected models: ['distilled', 'distilled_seed44', 'vanilla']
2025-11-04 17:44:04,571 - INFO - Models to process: ['distilled', 'distilled_seed44', 'vanilla']
2025-11-04 17:44:04,571 - INFO - OD sources: ['train', 'test']
2025-11-04 17:44:04,572 - INFO - ‚è≠Ô∏è  Skipping phase: generation
2025-11-04 17:44:04,572 - INFO - ‚è≠Ô∏è  Skipping phase: base_eval
2025-11-04 17:44:04,572 - INFO - ‚è≠Ô∏è  Skipping phase: cross_dataset
2025-11-04 17:44:04,573 - INFO - ‚è≠Ô∏è  Skipping phase: road_network_translate
2025-11-04 17:44:04,573 - INFO - 
======================================================================
2025-11-04 17:44:04,573 - INFO - üöÄ Running phase: abnormal
2025-11-04 17:44:04,573 - INFO - ======================================================================
2025-11-04 17:44:04,574 - INFO - üîç Running abnormal detection...
2025-11-04 17:44:04,574 - INFO - 
üîç Starting abnormal trajectory detection analysis...
2025-11-04 17:44:04,576 - INFO - Will analyze 2 dataset(s): ['Beijing', 'BJUT_Beijing']
2025-11-04 17:44:04,577 - INFO - 
======================================================================
2025-11-04 17:44:04,577 - INFO - üìä Analyzing dataset: Beijing (main)
2025-11-04 17:44:04,577 - INFO - ======================================================================
2025-11-04 17:44:04,577 - INFO - 
üîç Step 1: Detecting abnormal trajectories in real data...
2025-11-04 17:44:04,594 - INFO - 
  üìÇ Processing train data...
2025-11-04 17:44:04,594 - INFO -     üîç Detecting abnormal trajectories in REAL data...
2025-11-04 17:44:04,594 - INFO - üîç Starting abnormal trajectory analysis...
2025-11-04 17:44:04,595 - INFO - üìÇ Dataset: Beijing
2025-11-04 17:44:04,595 - INFO - üìÇ Input file: /home/matt/Dev/HOSER/data/Beijing/train.csv
2025-11-04 17:44:04,595 - INFO - ‚öôÔ∏è  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:44:04,602 - INFO - üíæ Output directory: abnormal/Beijing/train/real_data
2025-11-04 17:44:04,608 - INFO - üîç Detection method: wang_statistical
2025-11-04 17:44:04,608 - INFO - ‚öôÔ∏è  Loading configuration...
2025-11-04 17:44:04,609 - INFO - üìÇ Loading road network...
2025-11-04 17:44:06,479 - INFO - üìÇ Loading real trajectories...
2025-11-04 17:46:35,997 - INFO - ‚úÖ Loaded 629380 trajectories
2025-11-04 17:46:35,997 - INFO - üìä Using Wang et al. 2018 statistical detection
2025-11-04 17:46:36,010 - INFO - ‚úÖ Found baselines: baselines_beijing.json
2025-11-04 17:46:36,011 - INFO - üìä Loading baseline statistics from /home/matt/Dev/HOSER/hoser-distill-optuna-6/../baselines/baselines_beijing.json
2025-11-04 17:46:41,530 - INFO - ‚úÖ Loaded baselines for 712,435 OD pairs
2025-11-04 17:46:41,530 - INFO -    OD pairs with ‚â•5 samples: 4,268 (0.6%)
2025-11-04 17:47:26,331 - INFO - üìä Prepared 629380 trajectories for analysis
2025-11-04 17:47:28,437 - INFO - ‚úÖ Wang Statistical Detector initialized
2025-11-04 17:47:28,437 - INFO -    Threshold strategy: hybrid
2025-11-04 17:47:28,437 - INFO -    Fixed thresholds: L_œÅ=5000m, T_œÅ=300s
2025-11-04 17:47:28,437 - INFO -    Statistical multipliers: œÉ_length=2.5, œÉ_time=2.5
2025-11-04 17:47:28,437 - INFO - üîç Analyzing 629,380 trajectories...
2025-11-04 17:47:36,285 - INFO -    Processed 10,000 / 629,380 trajectories...
2025-11-04 17:47:37,626 - INFO -    Processed 20,000 / 629,380 trajectories...
2025-11-04 17:47:38,928 - INFO -    Processed 30,000 / 629,380 trajectories...
2025-11-04 17:47:40,244 - INFO -    Processed 40,000 / 629,380 trajectories...
2025-11-04 17:47:41,530 - INFO -    Processed 50,000 / 629,380 trajectories...
2025-11-04 17:47:42,843 - INFO -    Processed 60,000 / 629,380 trajectories...
2025-11-04 17:47:44,183 - INFO -    Processed 70,000 / 629,380 trajectories...
2025-11-04 17:47:45,450 - INFO -    Processed 80,000 / 629,380 trajectories...
2025-11-04 17:47:46,681 - INFO -    Processed 90,000 / 629,380 trajectories...
2025-11-04 17:47:47,917 - INFO -    Processed 100,000 / 629,380 trajectories...
2025-11-04 17:47:49,130 - INFO -    Processed 110,000 / 629,380 trajectories...
2025-11-04 17:47:50,437 - INFO -    Processed 120,000 / 629,380 trajectories...
2025-11-04 17:47:51,649 - INFO -    Processed 130,000 / 629,380 trajectories...
2025-11-04 17:47:52,914 - INFO -    Processed 140,000 / 629,380 trajectories...
2025-11-04 17:47:54,220 - INFO -    Processed 150,000 / 629,380 trajectories...
2025-11-04 17:47:55,459 - INFO -    Processed 160,000 / 629,380 trajectories...
2025-11-04 17:47:56,710 - INFO -    Processed 170,000 / 629,380 trajectories...
2025-11-04 17:47:57,975 - INFO -    Processed 180,000 / 629,380 trajectories...
2025-11-04 17:47:59,231 - INFO -    Processed 190,000 / 629,380 trajectories...
2025-11-04 17:48:00,492 - INFO -    Processed 200,000 / 629,380 trajectories...
2025-11-04 17:48:01,713 - INFO -    Processed 210,000 / 629,380 trajectories...
2025-11-04 17:48:03,010 - INFO -    Processed 220,000 / 629,380 trajectories...
2025-11-04 17:48:04,262 - INFO -    Processed 230,000 / 629,380 trajectories...
2025-11-04 17:48:05,578 - INFO -    Processed 240,000 / 629,380 trajectories...
2025-11-04 17:48:06,780 - INFO -    Processed 250,000 / 629,380 trajectories...
2025-11-04 17:48:08,054 - INFO -    Processed 260,000 / 629,380 trajectories...
2025-11-04 17:48:09,339 - INFO -    Processed 270,000 / 629,380 trajectories...
2025-11-04 17:48:10,603 - INFO -    Processed 280,000 / 629,380 trajectories...
2025-11-04 17:48:11,852 - INFO -    Processed 290,000 / 629,380 trajectories...
2025-11-04 17:48:13,124 - INFO -    Processed 300,000 / 629,380 trajectories...
2025-11-04 17:48:14,400 - INFO -    Processed 310,000 / 629,380 trajectories...
2025-11-04 17:48:15,675 - INFO -    Processed 320,000 / 629,380 trajectories...
2025-11-04 17:48:16,938 - INFO -    Processed 330,000 / 629,380 trajectories...
2025-11-04 17:48:18,218 - INFO -    Processed 340,000 / 629,380 trajectories...
2025-11-04 17:48:19,466 - INFO -    Processed 350,000 / 629,380 trajectories...
2025-11-04 17:48:20,744 - INFO -    Processed 360,000 / 629,380 trajectories...
2025-11-04 17:48:22,019 - INFO -    Processed 370,000 / 629,380 trajectories...
2025-11-04 17:48:23,263 - INFO -    Processed 380,000 / 629,380 trajectories...
2025-11-04 17:48:24,523 - INFO -    Processed 390,000 / 629,380 trajectories...
2025-11-04 17:48:25,787 - INFO -    Processed 400,000 / 629,380 trajectories...
2025-11-04 17:48:27,043 - INFO -    Processed 410,000 / 629,380 trajectories...
2025-11-04 17:48:28,344 - INFO -    Processed 420,000 / 629,380 trajectories...
2025-11-04 17:48:29,615 - INFO -    Processed 430,000 / 629,380 trajectories...
2025-11-04 17:48:30,852 - INFO -    Processed 440,000 / 629,380 trajectories...
2025-11-04 17:48:32,121 - INFO -    Processed 450,000 / 629,380 trajectories...
2025-11-04 17:48:33,384 - INFO -    Processed 460,000 / 629,380 trajectories...
2025-11-04 17:48:34,639 - INFO -    Processed 470,000 / 629,380 trajectories...
2025-11-04 17:48:35,892 - INFO -    Processed 480,000 / 629,380 trajectories...
2025-11-04 17:48:37,179 - INFO -    Processed 490,000 / 629,380 trajectories...
2025-11-04 17:48:38,477 - INFO -    Processed 500,000 / 629,380 trajectories...
2025-11-04 17:48:39,728 - INFO -    Processed 510,000 / 629,380 trajectories...
2025-11-04 17:48:41,003 - INFO -    Processed 520,000 / 629,380 trajectories...
2025-11-04 17:48:42,281 - INFO -    Processed 530,000 / 629,380 trajectories...
2025-11-04 17:48:43,536 - INFO -    Processed 540,000 / 629,380 trajectories...
2025-11-04 17:48:44,780 - INFO -    Processed 550,000 / 629,380 trajectories...
2025-11-04 17:48:46,056 - INFO -    Processed 560,000 / 629,380 trajectories...
2025-11-04 17:48:47,293 - INFO -    Processed 570,000 / 629,380 trajectories...
2025-11-04 17:48:48,541 - INFO -    Processed 580,000 / 629,380 trajectories...
2025-11-04 17:48:49,799 - INFO -    Processed 590,000 / 629,380 trajectories...
2025-11-04 17:48:52,921 - INFO -    Processed 600,000 / 629,380 trajectories...
2025-11-04 17:48:54,172 - INFO -    Processed 610,000 / 629,380 trajectories...
2025-11-04 17:48:55,395 - INFO -    Processed 620,000 / 629,380 trajectories...
2025-11-04 17:48:56,578 - INFO - üìä Detection Results:
2025-11-04 17:48:56,578 - INFO -    Total trajectories: 629,380
2025-11-04 17:48:56,578 - INFO -    Abp1 (Normal): 490,846
2025-11-04 17:48:56,578 - INFO -    Abp2 (Temporal delay): 138,534
2025-11-04 17:48:56,578 - INFO -    Abp3 (Route deviation): 0
2025-11-04 17:48:56,578 - INFO -    Abp4 (Both deviations): 0
2025-11-04 17:48:56,578 - INFO -    Abnormal rate: 22.01%
2025-11-04 17:48:56,578 - INFO - üìä Baseline usage:
2025-11-04 17:48:56,578 - INFO -    OD-specific: 25,536
2025-11-04 17:48:56,579 - INFO -    Global fallback: 603,844
2025-11-04 17:48:57,469 - INFO - üíæ Saving detection results...
2025-11-04 17:48:57,697 - INFO - ‚úÖ Saved detection results to abnormal/Beijing/train/real_data/detection_results.json
2025-11-04 17:48:57,698 - INFO - ‚úÖ Saved statistics to abnormal/Beijing/train/real_data/statistics_by_category.json
2025-11-04 17:48:57,703 - INFO - üíæ Saving trajectory samples...
2025-11-04 17:48:57,704 - ERROR -   ‚ùå Abnormal analysis failed for train: 'all_results'
Traceback (most recent call last):
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../python_pipeline.py", line 1114, in _analyze_dataset_abnormalities
    real_results = run_abnormal_analysis(
                   ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/matt/Dev/HOSER/hoser-distill-optuna-6/../tools/analyze_abnormal.py", line 656, in run_abnormal_analysis
    (r for r in results["all_results"] if r["traj_idx"] == idx), None
                ~~~~~~~^^^^^^^^^^^^^^^
KeyError: 'all_results'
2025-11-04 17:48:58,110 - INFO - 
  üìÇ Processing test data...
2025-11-04 17:48:58,110 - INFO -     üîç Detecting abnormal trajectories in REAL data...
2025-11-04 17:48:58,111 - INFO - üîç Starting abnormal trajectory analysis...
2025-11-04 17:48:58,111 - INFO - üìÇ Dataset: Beijing
2025-11-04 17:48:58,111 - INFO - üìÇ Input file: /home/matt/Dev/HOSER/data/Beijing/test.csv
2025-11-04 17:48:58,111 - INFO - ‚öôÔ∏è  Config: config/abnormal_detection_statistical.yaml
2025-11-04 17:48:58,122 - INFO - üíæ Output directory: abnormal/Beijing/test/real_data
2025-11-04 17:48:58,129 - INFO - üîç Detection method: wang_statistical
2025-11-04 17:48:58,129 - INFO - ‚öôÔ∏è  Loading configuration...
2025-11-04 17:48:58,129 - INFO - üìÇ Loading road network...
2025-11-04 17:48:58,171 - INFO - üìÇ Loading real trajectories...
