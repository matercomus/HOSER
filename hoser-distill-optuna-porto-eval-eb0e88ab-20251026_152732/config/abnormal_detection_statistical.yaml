# Wang et al. 2018 Statistical Abnormality Detection Configuration
# COMPARISON MODE: Runs BOTH old threshold-based and new statistical detection
#
# Methodology: Detecting Anomalous Trajectories and Behavior Patterns Using 
# Hierarchical Clustering from Taxi GPS Data
# Citation: Wang, Y., Qin, K., Chen, Y., & Zhao, P. (2018). 
# ISPRS International Journal of Geo-Information, 7(1), 25.

# Dataset configuration
dataset: porto_hoser
baseline_dataset: porto_hoser

# Detection method: "both" runs comparison between old and new methods
detection:
  method: "both"  # Options: "z_score" (old), "wang_statistical" (new), "both" (comparison)

# Wang et al. 2018 Statistical Detection Parameters
wang_statistical:
  # Fixed thresholds from Wang et al. 2018 paper
  L_rho_meters: 5000  # Route deviation threshold: 5km
  T_rho_seconds: 300  # Temporal delay threshold: 5 minutes (300 seconds)
  
  # Statistical multipliers (sigma values)
  sigma_length: 2.5   # Length deviation: mean + 2.5σ
  sigma_time: 2.5     # Time deviation: mean + 2.5σ
  sigma_speed: 3.0    # Speed outlier detection: mean + 3σ (for future use)
  
  # Threshold strategy: "fixed", "statistical", or "hybrid"
  # - fixed: Use Wang et al. fixed thresholds only (5km/5min)
  # - statistical: Use statistical multipliers only (2.5σ)
  # - hybrid: Use most stringent (minimum) of fixed and statistical (RECOMMENDED)
  threshold_strategy: "hybrid"
  
  # OD-pair baseline requirements
  min_samples_per_od: 5  # Minimum samples required for OD-specific baseline
  fallback_to_global: true  # Use global stats when OD pair has <5 samples

# Old threshold-based detection (z_score method)
z_score:
  threshold: 2.0

# Category-specific detection parameters (for old method)
categories:
  speeding:
    enabled: true
    speed_limit_kmh: 50      # Porto urban speed limit
    percentile_threshold: 85  # Top 15%
  
  detour:
    enabled: true
    detour_ratio_threshold: 1.3
    min_trip_length_km: 1.0
  
  suspicious_stops:
    enabled: true
    min_stop_duration_sec: 120  # 2 minutes
    max_stop_count: 3
  
  unusual_duration:
    enabled: true
    duration_ratio_threshold: 1.5
  
  circuitous:
    enabled: true
    straightness_threshold: 0.6

# Behavior Pattern Classification (Wang et al. 2018)
# Abp1: ALr ≤ NL + L_ρ AND ATr ≤ NT + T_ρ  → Normal
# Abp2: ALr ≤ NL + L_ρ AND ATr > NT + T_ρ  → Temporal delay (congestion, stops)
# Abp3: ALr > NL + L_ρ AND ATr ≤ NT + T_ρ  → Route deviation (detour, speeding)
# Abp4: ALr > NL + L_ρ AND ATr > NT + T_ρ  → Both deviations (major anomaly)

# Analysis and output configuration
analysis:
  save_trajectory_samples: true    # Save example trajectories for each pattern
  max_samples_per_pattern: 50      # Maximum samples to save per Abp pattern
  compute_speed_profiles: true     # Include speed analysis in results
  min_samples_per_category: 5      # Minimum samples for old method categories
  max_samples_per_category: 50     # Maximum samples for old method categories
  
# Translation quality filtering (optional - for cross-dataset evaluation)
translation_filtering:
  enabled: false  # Enable to filter by translation quality before detection
  min_translation_rate: 95.0  # Minimum percentage of successfully translated road IDs (0-100%)
  require_quality_file: true  # Fail if quality file not found (false = skip filtering)

# Logging and debugging
logging:
  log_baseline_misses: false  # Log when OD pairs not found in baselines
  log_threshold_details: false  # Log detailed threshold calculations
  progress_interval: 10000  # Log progress every N trajectories

